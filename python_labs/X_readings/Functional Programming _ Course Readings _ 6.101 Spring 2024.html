<!DOCTYPE html>

<html>
<head>
<!-- This page was generated by CAT-SOOP 19.0.6+hg.3.118aecfb.  miau. -->
<meta charset="utf-8"/>
<title>Functional Programming | Course Readings | 6.101 Spring 2024</title>
<link href="https://py.mit.edu/_static/spring24/logo.gif" rel="icon" type="image/gif"/>
<!-- include catsoop base css -->
<link href="https://py.mit.edu/_static/_base/themes/base.css" rel="stylesheet" type="text/css"/>
<!-- set up JS namespace for catsoop -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    var catsoop = {plugins: {}};

    function toggleResponsiveHeader(){
        document.getElementsByTagName('header')[0].classList.toggle('responsive');
    }

    function toggleAttribute(elt, attr){
        elt.setAttribute(attr, elt.getAttribute(attr) === "true" ? "false" : "true");
    }

    catsoop.topMenuFocus = function(event) {
        var elt = event.target;
        var target = event.relatedTarget;
        if (elt.classList.contains('menu-submenu')){
            var topmenu = elt.parentNode.parentNode;
            if (target && !target.classList.contains("menu-submenu") && target !== topmenu.children[1]) {
                clearMenu(topmenu);
            }
        }else if (!target.classList.contains('cs_top_menu_item')){
            clearMenu(elt.parentNode);
        }
    }

    window.addEventListener('DOMContentLoaded', function(){
        var menu_boxes = document.getElementsByClassName('dropdown-checkbox');
        for(var i=0; i<menu_boxes.length; i++){
            menu_boxes[i].checked = false;
        }
    });

    function clearMenu(menu){
       menu.children[1].checked = false;
    }
    // @license-end
    </script>
<!-- dark mode -->
<script src="https://py.mit.edu/_static/_base/js/darkreader/darkreader.min.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.dark_mode_settings = null;
    if (catsoop.dark_mode_settings === null){
        catsoop.dark_mode_settings = JSON.parse(localStorage.getItem('catsoop_dark_mode_settings'));
        if (catsoop.dark_mode_settings === null){
            catsoop.dark_mode_settings = {'mode': 'disabled', 'brightness': 100, 'contrast': 90, 'sepia': 10, 'grayscale': 0};
        }
    }
    localStorage.setItem('catsoop_dark_mode_settings', JSON.stringify(catsoop.dark_mode_settings));
    catsoop.dark_mode = catsoop.dark_mode_settings.mode;
    delete catsoop.dark_mode_settings.mode;
    if (catsoop.dark_mode === 'enabled' || catsoop.dark_mode === 'auto'){
        DarkReader[catsoop.dark_mode == 'enabled' ? 'enable' : 'auto'](catsoop.dark_mode_settings);
    }
    
    document.addEventListener("DOMContentLoaded", function(event) {
        if (DarkReader.isEnabled()) {
            var invertfilter = 'invert(100%) hue-rotate(180deg)' +
                               ' brightness(' + catsoop.dark_mode_settings.brightness + '%)' +
                               ' contrast(' + catsoop.dark_mode_settings.contrast + '%)' +
                               ' grayscale(' + catsoop.dark_mode_settings.grayscale + '%)' +
                               ' sepia(' + catsoop.dark_mode_settings.sepia + '%)'
            var inverter = document.createElement('style');
            inverter.innerText = 'img.catsoop-darkmode-invert, video.catsoop-darkmode-invert {filter: ' + invertfilter + ';}\n\n'
            document.head.appendChild(inverter);
        }
    });
    // @license-end
    </script>
<!-- load in mathjax and CAT-SOOP-specific math rendering  -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    MathJax = {
      startup: {
        typeset: false,
      }
    }

    catsoop.render_math = function (elt) {
        if(elt.classList.contains('cs_displaymath')){
            var b = "\\[";
            var e = "\\]";
        }else{
            var b = "\\(";
            var e = "\\)";
        }
        elt.innerText = b + elt.innerText + e;
        MathJax.typeset([elt]);
        elt.classList.remove('cs_math_to_render');
    }


    catsoop.render_all_math = function (elt){
        if (elt === null) {
            return;
        }
        var mathelts = elt.getElementsByClassName('cs_math_to_render');
        while(mathelts.length > 0){
            catsoop.render_math(mathelts[0]);
        }
    }
    document.addEventListener("DOMContentLoaded", function(event) {
          catsoop.render_all_math(document);
    });
    // @license-end
    </script>
<script id="MathJax-script" src="https://py.mit.edu/_static/_base/js/mathjax/tex-chtml-full-speech.js"></script>
<!-- load in diagram stuff -->
<script src="https://py.mit.edu/_static/_base/js/cs_diagrams.js" type="text/javascript"></script>
<script type="text/javascript">
        catsoop.diagram_sources = {};
    </script>
<!-- Syntax Highlighting -->
<script src="https://py.mit.edu/_static/_base/js/highlight/highlight.min.js" type="text/javascript"></script>
<script src="https://py.mit.edu/_static/_base/js/highlightjs-line-numbers.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.syntax_highlighting = function (elt) {
        if (elt === null) {
            return;
        }
        elt.querySelectorAll('pre > code:not(.highlighted)').forEach((block) => {
            hljs.highlightBlock(block);
            var wrap = document.createElement("section");
            wrap.setAttribute("aria-label", "Code block");
            block.parentNode.replaceWith(wrap);
            wrap.append(block.parentNode);
            block.classList.add('highlighted');
        });
        elt.querySelectorAll('code.highlight-lines').forEach(function(b){
            hljs.lineNumbersBlock(b);
            if ((b.innerHTML.trim().match(/\r\n|\r|\n/g) || []).length > 0){
                b.parentElement.style = "padding-left: 0px !important;"
                b.classList.add('hljs');
            }
            b.classList.remove('highlight-lines');
        });
    }
    window.addEventListener('DOMContentLoaded', function(){
        catsoop.syntax_highlighting(document);
    });
    // @license-end
    </script>
<style>
      :root {
        --cs-base-bg-color: #0350ba;
        --cs-light-bg-color: #629ced;
        --cs-base-font-color: #fff;
        --cs-light-font-color: #000;
    }
    </style>
<style>
.cs_top_menu_item {
  font-size: 0.88rem;
}
div.dropdown {
  -moz-transform: translateY(-1px);
}
img {
  max-width:100% !important;
}
</style>
<style>
[id^=cs_qdiv].question-lab101 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101 [id$=nsubmits_left] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style2 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style2 [id$=nsubmits_left] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style1 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style1 [id$=nsubmits_left] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style3 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style3 [id$=nsubmits_left] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style4 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style4 [id$=nsubmits_left] {
  display: none;
}
</style>
<style>
h2.cs_section_title {
   margin-top: 3em;
}
h3.cs_section_title {
   margin-top: 3em;
}
h4.cs_section_title {
   margin-top: 2em;
}
code.hljs {
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
img.envdia {
  border-radius: 5px;
  border: 2px #ccc solid;
}
img.pixels {
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}
button[id$=clearanswer] {
  display: none;
}
.flex { display: flex; flex-wrap: wrap; }
.flex > pre { flex: 1; }
.flex > img { flex: 0 1; }
</style>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function (){
    document.querySelectorAll("img.envdia").forEach(function (b){
        b.classList.add("catsoop-darkmode-invert")
    });
});
</script>
<script src="https://py.mit.edu/_static/spring24/readings/multistep.js" type="text/javascript"></script>
<link href="https://py.mit.edu/_static/spring24/readings/multistep.css" rel="stylesheet"/>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.addEventListener("DOMContentLoaded", function(){
    sessionStorage.setItem("last-non-settings", catsoop.this_path);
});
// @license-end
</script>
<script src="https://py.mit.edu/_static/_handler/default/cs_ajax.js" type="text/javascript"></script>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
</head>
<body style="margin: 0px;">
<header id="cs_header">
<div aria-role="menubar" class="nav-container">
<div class="cs_header_text"><a href="https://py.mit.edu/spring24"><img src="https://py.mit.edu/_static/spring24/logo.gif"/> 6.101</a></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_a47c0b052b07cf284d5c1a10c5c01779">Information<span aria-hidden="true" class="downarrow">▼</span></label>
<input checked="false" class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_a47c0b052b07cf284d5c1a10c5c01779" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox"/>
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/basics" onblur="catsoop.topMenuFocus(event);" role="menuitem">Basics and Schedule</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/grading" onblur="catsoop.topMenuFocus(event);" role="menuitem">Grading Policies</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/academic_integrity" onblur="catsoop.topMenuFocus(event);" role="menuitem">Academic Integrity</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/help" onblur="catsoop.topMenuFocus(event);" role="menuitem">Getting Help</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/staff" onblur="catsoop.topMenuFocus(event);" role="menuitem">Staff List</a></div></div>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring24/readings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Readings</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring24/queue" onblur="catsoop.topMenuFocus(event);" role="menuitem">Queue</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring24/progress" onblur="catsoop.topMenuFocus(event);" role="menuitem">Progress</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring24/infrastructure" onblur="catsoop.topMenuFocus(event);" role="menuitem">Infrastructure</a>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_c6f88f23ee3b616620af5df156228d2a">gvargas1<span aria-hidden="true" class="downarrow">▼</span></label>
<input checked="false" class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_c6f88f23ee3b616620af5df156228d2a" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox"/>
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/ssh_keys" onblur="catsoop.topMenuFocus(event);" role="menuitem">Manage SSH Keys</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/_util/user_settings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Settings</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/readings/functional_programming?loginaction=logout" onblur="catsoop.topMenuFocus(event);" role="menuitem">Log Out</a></div></div><a class="icon" href="javascript:void(0);" onclick="toggleResponsiveHeader()">☰</a>
</div>
</header>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_top_navigation" id="cs_breadcrumbs"><li><a href="https://py.mit.edu/spring24">Home</a></li><li><a href="https://py.mit.edu/spring24/readings">Course Readings</a></li><li><a href="https://py.mit.edu/spring24/readings/functional_programming">Functional Programming</a></li></nav>
<div class="cs_body" id="cs_body">
<div class="cs_left_menu"></div>
<div class="cs_content">
<div class="cs_page_body" role="main">
<center><h1 class="cs_content_header">Functional Programming</h1></center>
<div class="callout callout-warning" markdown="">
<p>This reading is relatively new, and your feedback will help us
improve it!  If you notice mistakes (big or small), if you have questions, if
anything is unclear, if there are things not covered here that you'd like to
see covered, or if you have any other suggestions; please get in touch during
office hours or open lab hours, or via e-mail at <code>6.101-help@mit.edu</code>.</p>
</div>
<h2 aria-hidden="true">Table of Contents</h2><ul aria-label="Table of Contents" role="navigation"><li><a href="#_introduction">1) Introduction</a></li><li><a href="#_more_iteration_to_recursion">2) More Iteration to Recursion</a></li><li><a href="#_classes_to_functions">3) Classes to Functions</a></li><ul><li><a href="#_aside_nonlocal">3.1) Aside: <code>nonlocal</code></a></li></ul><li><a href="#_memoization">4) Memoization</a></li></ul>
<p><a class="anchor" name="catsoop_section_1"></a><a class="anchor" name="_introduction"></a><h2 class="cs_section_title">1) Introduction<a class="cs_permalink" href="#_introduction">§</a></h2></p>
<p>Functions were one of the first Python features that we <a href="functions">studied</a>
this semester, but they are a remarkably versatile feature that deserves more
attention.  <a href="https://en.wikipedia.org/wiki/Functional_programming"><em>Functional
programming</em></a> is a
classic programming style heavily focused on functions.  As recently as the
mid-2000s, functional programming was seen by industry as a niche academic
idea, but, in the mean time, it went quite mainstream.  While it was originally
associated with distinct programming languages like
<a href="https://en.wikipedia.org/wiki/Haskell">Haskell</a>, many of its best ideas were
adopted by better-known languages like Python.  We've been using those features
(like <code>lambda</code>) all along this semester, and this reading will show you even
more handy patterns in functional programming.</p>
<p>As it happens, one of the first programming languages that worked on multiple
different kinds of computers was
<a href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">LISP</a>, and it
arguably introduced functional programming as a practical style, way back in
1958.  This week's lab will lead you through implementing your own subset of
LISP.  Getting a better understanding of functions and their uses is also
directly relevant to that experience.</p>
<p><a class="anchor" name="catsoop_section_2"></a><a class="anchor" name="_more_iteration_to_recursion"></a><h2 class="cs_section_title">2) More Iteration to Recursion<a class="cs_permalink" href="#_more_iteration_to_recursion">§</a></h2></p>
<p>One interesting feature of LISP is that it does not feature any looping
structures (there are no <code>for</code> or <code>while</code> loops).  But it does have functions,
and, <a href="recursion2">as we've seen before</a>, it's possible to use functions to
implement loops.  One of the first examples we looked at, factorial, could
always be written with a loop like so:</p>
<pre><code class="language-python">def factorial(n):
    result = 1
    for i in range(1, n+1):
        result *= i
    return result
</code></pre>
<p>But we also learned that it can be written recursively as a one-liner.</p>
<pre><code class="language-python">def factorial(n):
    return 1 if n &lt;= 1 else n * factorial(n-1)
</code></pre>
<p>In the LISP, every function needs to be written in this style, effectively as a
single <code>return</code> with an expression that does all the heavy lifting!</p>
<p>Consider this example, which capitalizes all words in a list:</p>
<pre><code class="language-python">def all_caps_list(words):
    return [w.upper() for w in words]
</code></pre>
<p>We can apply another of our recursion patterns, the <strong>first/rest</strong>
decomposition, to write a recursive version.</p>
<pre><code class="language-python">def all_caps_list(words):
    if len(words) == 1:
        return words[0].upper()
    else:
        return [words[0].upper()] + all_caps_list(words[1:])
</code></pre>
<p>
<!--START question all_caps_list --><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_all_caps_list" style="position: static">
<div id="all_caps_list_rendered_question">
<div id="catsoop_preamble_all_caps_list"></div>
<div id="catsoop_prompt_all_caps_list" style="display: inline;">How does this recursive version behave on lists of strings?<br/></div>
<select aria-labelledby="catsoop_prompt_all_caps_list" id="all_caps_list" name="all_caps_list">
<option value="-1">--</option>
<option value="0">It works as expected.</option>
<option value="1">It contains a Python syntax error.</option>
<option selected="" value="2">It will raise an exception when it runs.</option>
<option value="3">It will return wrong answers.</option></select>
</div><div>
<span id="all_caps_list_buttons">
<button class="submit btn btn-catsoop" id="all_caps_list_submit" onclick="catsoop.submit('all_caps_list');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="all_caps_list_clearanswer" onclick="catsoop.clearanswer('all_caps_list');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="all_caps_list_loading_wrapper" role="status">
<span id="all_caps_list_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="all_caps_list_score_display" role="status"></span>
<div class="nsubmits_left" id="all_caps_list_nsubmits_left" role="status">You have submitted this assignment 2 times.</div></div>
<div class="solution" id="all_caps_list_solution_container">
<div id="all_caps_list_solution">
<b>Solution:</b> It will raise an exception when it runs.
</div>
<div id="all_caps_list_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>Something is off in the base case: it returns a string instead of a list, so the recursive case tries to add a list to a string.
The result is an exception.
We could fix it by putting extra square brackets around the return value in the base case, but actually we can do even better by adopting a simpler base case.</p>
<pre><code class="language-python">def all_caps_list(words):
    if len(words) == 0:
        return []
    else:
        return [words[0].upper()] + all_caps_list(words[1:])
</code></pre>
</div>
</div>
<div aria-atomic="true" id="all_caps_list_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question all_caps_list -->
</p>
<p>It may be surprising how many loops can be turned into instances of recursion.
Consider this basic one.</p>
<pre><code class="language-python">for i in range(n):
    print('hello', i)
</code></pre>
<p>This structure might seem a little bit trickier to implement using recursion,
but we'll see that we can indeed do it, using a <strong>higher-order function</strong>
(meaning a function that takes a function as input).  Here, we encode what was
the body of our loop (i.e., the thing we want to repeat multiple times) as a
function; then we call that function repeatedly, using recursion to keep track
of how many times we still need to run that code.</p>
<pre><code class="language-python">def repeat_n_times(n, func):
    if n == 0:
        return
    func(n)
    repeat_n_times(n-1, func)
</code></pre>
<p>
<!--START question repeat_n_times --><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_repeat_n_times" style="position: static">
<div id="repeat_n_times_rendered_question">
<div id="catsoop_preamble_repeat_n_times"></div>
<div id="catsoop_prompt_repeat_n_times" style="display: inline;">What happens when we call <code>repeat_n_times(20, lambda i: print('hello', i))</code>?<br/></div>
<select aria-labelledby="catsoop_prompt_repeat_n_times" id="repeat_n_times" name="repeat_n_times">
<option value="-1">--</option>
<option value="0">It works as expected.</option>
<option value="1">It contains a Python syntax error.</option>
<option value="2">It will raise an exception when it runs.</option>
<option selected="" value="3">It will print different values than the original does.</option></select>
</div><div>
<span id="repeat_n_times_buttons">
<button class="submit btn btn-catsoop" id="repeat_n_times_submit" onclick="catsoop.submit('repeat_n_times');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="repeat_n_times_clearanswer" onclick="catsoop.clearanswer('repeat_n_times');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="repeat_n_times_loading_wrapper" role="status">
<span id="repeat_n_times_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="repeat_n_times_score_display" role="status"></span>
<div class="nsubmits_left" id="repeat_n_times_nsubmits_left" role="status">You have submitted this assignment 3 times.</div></div>
<div class="solution" id="repeat_n_times_solution_container">
<div id="repeat_n_times_solution">
<b>Solution:</b> It will print different values than the original does.
</div>
<div id="repeat_n_times_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>Whoops, this version counts down <em>backward</em> and stops at one instead of zero!
We can fix it using our pattern of adding a <code>sofar</code> argument.</p>
<pre><code class="language-python">def repeat_n_times(n, func, sofar=0):
    if sofar == n:
        return
    func(sofar)
    repeat_n_times(n, func, sofar+1)
</code></pre>
<p>There is also a fancier solution that even better shows off the power of
functions as data.  Do you see why this version works, too?</p>
<pre><code class="language-python">def repeat_n_times(n, func):
    if n == 0:
        return
    func(0)
    repeat_n_times(n-1, lambda x: func(x+1))
</code></pre>
</div>
</div>
<div aria-atomic="true" id="repeat_n_times_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question repeat_n_times -->
</p>
<p><a class="anchor" name="catsoop_section_3"></a><a class="anchor" name="_classes_to_functions"></a><h2 class="cs_section_title">3) Classes to Functions<a class="cs_permalink" href="#_classes_to_functions">§</a></h2></p>
<p>Object-oriented programming, e.g. with classes in Python, is commonly used in industry
as a way to organize complex code bases.  However,
essentially any use of classes can be reimplemented with functions in Python.
Let's look at two examples.</p>
<p>We can build a simple "bank" class that helps us maintain multiple named
numeric balances.</p>
<pre><code class="language-python">class Bank:
    def __init__(self):
        self.accounts = {}

    def balance_of(self, account):
        return self.accounts.get(account, 0)

    def deposit(self, account, amount):
        self.accounts[account] = self.balance_of(account) + amount
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; b = Bank()
&gt;&gt;&gt; b.deposit('Steve', 3)
&gt;&gt;&gt; b.deposit('Magdalena', 4)
&gt;&gt;&gt; b.deposit('Steve', 5)
&gt;&gt;&gt; b.balance_of('Steve')
8
&gt;&gt;&gt; b.balance_of('Magdalena')
4
</code></pre>
<p>The chance to <em>encapsulate</em> the details of balance maintenance within a class
pays off when it comes to writing and maintaining programs.  However, functions
also provide us all the ingredients we need to the same end.  Consider the
following code:</p>
<pre><code class="language-python">def bank():
    accounts = {}

    def balance_of(account):
        return accounts.get(account, 0)

    def deposit(account, amount):
        accounts[account] = balance_of(account) + amount

    return balance_of, deposit
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; balance_of, deposit = bank()
&gt;&gt;&gt; deposit('Steve', 3)
&gt;&gt;&gt; deposit('Magdalena', 4)
&gt;&gt;&gt; deposit('Steve', 5)
&gt;&gt;&gt; balance_of('Steve')
8
&gt;&gt;&gt; balance_of('Magdalena')
4
</code></pre>
<p>It's important that the two functions that <code>bank()</code> returns, <code>balance_of</code> and
<code>deposit</code>, share a freshly created enclosing frame with a new <code>accounts</code>
dictionary.  This frame is equivalent to the object in the object-oriented version.
If the details there are not clear, try drawing an environment diagram.</p>
<p><a class="anchor" name="catsoop_section_3_1"></a><a class="anchor" name="_aside_nonlocal"></a><h3 class="cs_section_title">3.1) Aside: <code>nonlocal</code><a class="cs_permalink" href="#_aside_nonlocal">§</a></h3></p>
<p>So far it looks like we'll have smooth sailing converting classes into
functions.  Here's a simpler example than the bank -- a counter that we can keep
incrementing by one.  But it reveals a subtle issue in Python with using variables
from an enclosing frame to store information.</p>
<pre><code class="language-python highlight-lines">def counter():
    tally = 0

    def increment():
        tally += 1
        return tally

    return increment
</code></pre>
<p>
<!--START question counter --><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_counter" style="position: static">
<div id="counter_rendered_question">
<div id="catsoop_preamble_counter"></div>
<div id="catsoop_prompt_counter" style="display: inline;">Consider running <code>inc = counter()</code> and then repeatedly calling <code>inc()</code>.  What happens when we do this?<br/></div>
<select aria-labelledby="catsoop_prompt_counter" id="counter" name="counter">
<option value="-1">--</option>
<option value="0">It works as expected.</option>
<option value="1">The code has a Python syntax error to begin with.</option>
<option selected="" value="2">It will raise an exception when it runs.</option>
<option value="3">It will return incorrect values.</option></select>
</div><div>
<span id="counter_buttons">
<button class="submit btn btn-catsoop" id="counter_submit" onclick="catsoop.submit('counter');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="counter_clearanswer" onclick="catsoop.clearanswer('counter');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="counter_loading_wrapper" role="status">
<span id="counter_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="counter_score_display" role="status"></span>
<div class="nsubmits_left" id="counter_nsubmits_left" role="status">You have submitted this assignment 4 times.</div></div>
<div class="solution" id="counter_solution_container">
<div id="counter_solution">
<b>Solution:</b> It will raise an exception when it runs.
</div>
<div id="counter_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>Specifically, on line 5 <code>tally += 1</code>, we will get this error:</p>
<pre><code class="nohighlight">UnboundLocalError: cannot access local variable 'tally' where it is not associated with a value
</code></pre>
</div>
</div>
<div aria-atomic="true" id="counter_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question counter -->
</p>
<p>This code exhibits a common pitfall in Python.
Namely, variable <code>tally</code> in <code>increment</code> is being treated as <em>local</em> to that
function rather than inherited from the enclosing frame.
Why?</p>
<p>Because when a function <em>modifies</em> a variable, Python forces the variable to be
present directly in the function's frame... but here <code>tally</code> was not
initialized locally, so Python complains that <code>tally</code> does not exist.</p>
<p>But Python gives us a way to control this.  In particular, if we <em>want</em> to use
the variable <code>tally</code> from the enclosing frame inside of <code>increment</code>, we can
accomplish this using the <code>nonlocal</code> keyword:</p>
<pre><code class="language-python">def counter():
    tally = 0
    
    def increment():
        nonlocal tally
        tally += 1
        return tally

    return increment
</code></pre>
<p>The line <code>nonlocal tally</code> tells Python that whenever we refer to the name
<code>tally</code> inside of <code>increment</code> (whether we're just looking up the value <em>or</em>
setting/changing it), we should always be looking for the variable in one of our parent
frames, instead of in the local frame for calling <code>increment</code>.</p>
<div class="question"><b>Check Yourself:</b><p>Look back at the <code>bank</code> example from above:
<pre><code class="language-python">def bank():
    accounts = {}

    def balance_of(account):
        return accounts.get(account, 0)

    def deposit(account, amount):
        accounts[account] = balance_of(account) + amount

    return balance_of, deposit
</code></pre>
<p>The functions <code>balance_of</code> and <code>deposit</code> are using <code>accounts</code> from their enclosing frame to update the balances of bank accounts.</p>
<p>What's the difference between the way <code>bank</code> uses a variable from an enclosing frame and the way that <code>counter</code> does?
Why does <code>counter</code> need <code>nonlocal tally</code>, but <code>bank</code> doesn't need to say <code>nonlocal accounts</code>?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>The functions in <code>bank</code> only <em>read</em> the value of the <code>accounts</code> variable, to reach the dictionary of accounts.  The dictionary is mutated by <code>deposit</code>, but this doesn't involve reassigning the <code>accounts</code> variable itself.
<p>By contrast, <code>counter</code> needs to <em>reassign</em> the <code>tally</code> variable itself.  So you need to use <code>nonlocal</code> when you will assign to a variable in an enclosing frame, but not when you just need to use the variable's value.
</p></div></div></p><p><span id="queue_checkyourself_1"></span></p></div>
<p><a class="anchor" name="catsoop_section_4"></a><a class="anchor" name="_memoization"></a><h2 class="cs_section_title">4) Memoization<a class="cs_permalink" href="#_memoization">§</a></h2></p>
<p>We can also use higher-order functions to improve the performance of naive
code.  Here's a classic of recursion, a calculator for <a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci
numbers</a>.</p>
<pre><code class="language-python">def fib(n):
    if n &lt; 2:
        return n
    return fib(n-2) + fib(n-1)
</code></pre>
<div class="question"><b>Check Yourself:</b><p><p>Roughly how long will it take to compute <code>fib(100)</code>?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>It turns out that this will take a <em>really</em> long time!  Not only will it not
be finished if we step out to get a coffee or a sandwich, but it won't be
finished if we come back in a month, or a year, or even a decade.  In fact,
we expect this program, as written, to take longer than the estimated remaining
life of the universe, even if we had a really fast computer.
<p>What's causing this to be so slow?  Read on to find out!</p></div></div>
</p><p><span id="queue_checkyourself_2"></span></p></div>
<p>We can start to see why this is so slow by looking at a tree showing the
recursive calls that are made when computing <code>fib(100)</code>.  We start with a
single top-level call:</p>
<center>
<img class="envdia" src="https://py.mit.edu/_static/spring24/readings/functional_programming/fibtree1.png" width="400"/>
</center>
<p>That then makes two recursive calls:</p>
<center>
<img class="envdia" src="https://py.mit.edu/_static/spring24/readings/functional_programming/fibtree2.png" width="400"/>
</center>
<p>Each of those makes two recursive calls:</p>
<center>
<img class="envdia" src="https://py.mit.edu/_static/spring24/readings/functional_programming/fibtree3.png" width="400"/>
</center>
<p>And this pattern continues:</p>
<center>
<img class="envdia" src="https://py.mit.edu/_static/spring24/readings/functional_programming/fibtree4.png" width="400"/>
</center>
<p>
<!--START question fib_num_94 --><section aria-label="Question">
<div class="question question-pythonic" id="cs_qdiv_fib_num_94" style="position: static">
<div id="fib_num_94_rendered_question">
<div id="catsoop_preamble_fib_num_94"></div>
<div id="catsoop_prompt_fib_num_94" style="display: inline;">How many times will we ultimately make a call computing the 94<sup>th</sup> Fibonacci number, like <code>fib(94)</code>, in the structure above?  Enter your answer as an integer below:<br/></div><input aria-labelledby="catsoop_prompt_fib_num_94" id="fib_num_94" name="fib_num_94" size="50" type="text" value="13"/>
</div><div>
<span id="fib_num_94_buttons">
<button class="submit btn btn-catsoop" id="fib_num_94_submit" onclick="catsoop.submit('fib_num_94');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="fib_num_94_clearanswer" onclick="catsoop.clearanswer('fib_num_94');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="fib_num_94_loading_wrapper" role="status">
<span id="fib_num_94_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="fib_num_94_score_display" role="status"></span>
<div class="nsubmits_left" id="fib_num_94_nsubmits_left" role="status">You have submitted this assignment 11 times.</div></div>
<div class="solution" id="fib_num_94_solution_container">
<div id="fib_num_94_solution">
<p><b>Solution:</b> <tt>13</tt><p>
</p></p>
</div>
<div id="fib_num_94_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>Indeed, we call <code>fib(94)</code> 13 times during this process.
That's a lot of duplication!  And, in fact, there's a lot of duplication
elsewhere within the tree as well!</p>
<p>It's an edifying exercise to tally up how many calls each number receives:</p>
<table border="1">
<tr> <th>Argument</th> <th>#Calls</th> </tr>
<tr> <td>100</td> <td>1</td> </tr>
<tr> <td>99</td> <td>1</td> </tr>
<tr> <td>98</td> <td>2</td> </tr>
<tr> <td>97</td> <td>3</td> </tr>
<tr> <td>96</td> <td>5</td> </tr>
<tr> <td>95</td> <td>8</td> </tr>
<tr> <td>94</td> <td>13</td> </tr>
</table>
<p>Do you see an interesting pattern?  The call counts replicate the Fibonacci
numbers themselves!  Specifically, the call count for <code>fib(n)</code> in the recursion
is equal to the <span class="cs_math_to_render">(100-n)</span>th Fibonacci number.  Looking down at the bottom of
the recusion, the base case <code>fib(0)</code> will be called a number of times equal to
the 100th Fibonacci number.  Since that number <code>fib(100)</code> is a gigantic number,
we will make a gigantic number of recursive calls, which ultimately means that
this computation, as expressed above, is not really feasible.</p>
</div>
</div>
<div aria-atomic="true" id="fib_num_94_message" role="status"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/><br/></div>
</div>
</section>
<!--END question fib_num_94 -->
</p>
<p>But there's something interesting here, which we can exploit: even though we're
calling <code>fib(94)</code> multiple times, the result is always the same.  But in order
to find that result (as things are currently written), Python needs to explore
the <em>entire</em> subtree of the drawing above that's rooted at <code>94</code>, which takes a
<em>long time</em>.</p>
<p>We can see some of this repeated structure by highlighting the subtrees associated
with any given number, in this case 96:</p>
<center>
<img class="envdia" src="https://py.mit.edu/_static/spring24/readings/functional_programming/fibtree6.png" width="400"/>
</center>
<p>Any time we call <code>fib(96)</code> (multiple times shown here), Python will need to
explore an entire subtree to find that result, and the result will always be
the same.</p>
<p>What we'll try next is exploiting this repeated structure in the tree above by
<em>remembering</em> Fibonacci numbers as we compute them, so that we can reuse those
results later.  So, for example, when we call <code>fib(96)</code>, we'll first ask: have
I already computed this result?  If so, let's avoid repeating the work that took
and just return the result I've remembered.  Otherwise, let's do the computation
normally.  In that way, we can avoid exploring large swathes of the tree.  For
example, just remembering the result of <code>fib(96)</code> lets us cut out big parts of
the tree:</p>
<center>
<img class="envdia" src="https://py.mit.edu/_static/spring24/readings/functional_programming/fibtree7.png" width="400"/>
</center>
<p>But then we can do the same of <code>fib(97)</code>:</p>
<center>
<img class="envdia" src="https://py.mit.edu/_static/spring24/readings/functional_programming/fibtree8.png" width="400"/>
</center>
<p>and <code>fib(98)</code>:</p>
<center>
<img class="envdia" src="https://py.mit.edu/_static/spring24/readings/functional_programming/fibtree9.png" width="400"/>
</center>
<p>In fact, when we cross out all subtrees that are redundant in this way, we are
left with a remaining tree that, in general for <code>fib(n)</code>, only has about <code>n</code>
nodes that aren't crossed out.  Now <em>that</em> is much more tractable to compute.</p>
<p>Here's a Python realization of the idea:</p>
<pre><code class="language-python">cache = {}

def fib(n):
    if n not in cache:
        if n &lt; 2:
            cache[n] = n
        else:
            cache[n] = fib(n-2) + fib(n-1)
    return cache[n]
</code></pre>
<p>What's up with the word "cache"?  The English word referred originally to
something like the hiding place where a pirate stashed his treasure, but in
computer science, a <a href="https://en.wikipedia.org/wiki/Cache_(computing)">cache</a>
stores values that we think we will be consulting again soon.</p>
<p>We call the new <code>fib</code> <strong>memoized</strong>.  No, that's not a typo for "memorized."
<a href="https://en.wikipedia.org/wiki/Memoization">"Memoization"</a> is a
computer-science term for saving and reusing intermediate results, particularly
in problems with a lot of repeated structure like this one.</p>
<p>This code runs much more quickly, but it has a downside: it uses a global
variable.  All sorts of things can go wrong in larger code bases that include
global variables.  For instance, what if we wanted to use the same trick for a
factorial function?</p>
<pre><code class="language-python">cache = {}

def factorial(n):
    if n not in cache:
        if n &lt; 2:
            cache[n] = 1
        else:
            cache[n] = n * factorial(n-1)
    return cache[n]
</code></pre>
<p>Whoops, now both functions are sharing the same <code>cache</code> variable, and havoc
ensues!  (The initial assignment overwrites the existing global variable rather
than creating a new one.)  We would rather not force the authors of the two
functions to coordinate on variable-name selection.</p>
<p>Here's a version that avoids that issue by putting <code>cache</code> inside of an
enclosing frame:</p>
<pre><code class="language-python">def fib(n):
    cache = {}

    def _actual_fib(n):
        if n not in cache:
            if n &lt; 2:
                cache[n] = n
            else:
                cache[n] = _actual_fib(n-2) + _actual_fib(n-1)
        return cache[n]

    return _actual_fib(n)
</code></pre>
<p>
<!--START question fib_local_cache --><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_fib_local_cache" style="position: static">
<div id="fib_local_cache_rendered_question">
<div id="catsoop_preamble_fib_local_cache"></div>
<div id="catsoop_prompt_fib_local_cache" style="display: inline;">How does this version behave?<br/></div>
<select aria-labelledby="catsoop_prompt_fib_local_cache" id="fib_local_cache" name="fib_local_cache">
<option value="-1">--</option>
<option value="0">It gives correct answers and is about as fast as the last version.</option>
<option selected="" value="1">It gives correct answers and can be notably slower than the last version.</option>
<option value="2">It gives correct answers and can be notably faster than the last version.</option>
<option value="3">It contains a Python syntax error.</option>
<option value="4">It will raise an exception when it runs.</option>
<option value="5">It will return wrong answers.</option></select>
</div><div>
<span id="fib_local_cache_buttons">
<button class="submit btn btn-catsoop" id="fib_local_cache_submit" onclick="catsoop.submit('fib_local_cache');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="fib_local_cache_clearanswer" onclick="catsoop.clearanswer('fib_local_cache');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="fib_local_cache_loading_wrapper" role="status">
<span id="fib_local_cache_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="fib_local_cache_score_display" role="status"></span>
<div class="nsubmits_left" id="fib_local_cache_nsubmits_left" role="status">You have submitted this assignment 5 times.</div></div>
<div class="solution" id="fib_local_cache_solution_container">
<div id="fib_local_cache_solution">
<b>Solution:</b> It gives correct answers and can be notably slower than the last version.
</div>
<div id="fib_local_cache_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>Unfortunately, each <code>cache</code> here lasts only as long as a single call to <code>fib</code>.
The old version had the cool benefit of reusing results even across top-level
calls to <code>fib</code>.  Calling the previous version twice in a row should generate an
answer instantly for the second call, regardless of the argument.</p>
<p>Here is an alternative version, which you could be excused for thinking is too clever.</p>
<pre><code class="language-python">def fib(n, cache={}):
    if n not in cache:
        if n &lt; 2:
            cache[n] = n
        else:
            cache[n] = fib(n-2) + fib(n-1)
    return cache[n]
</code></pre>
<p>We take advantage of the behavior of default arguments in Python, where the expression to the right of <code>argument_name=</code> is evaluated just once, at function-definition time.
Thus, so long as we don't ever pass a second argument to <code>fib</code>, we continue reusing the same cache.
Since <code>cache</code> is now a local variable, we avoid the tribulations of global variables.</p>
<p>Perhaps a more straightforward version involves using a closure like so:</p>
<pre><code class="language-py">def make_memoized_fib():
    cache = {}

    def _real_fib(n):
        if n not in cache:
            if n &lt; 2:
                cache[n] = n
            else:
                cache[n] = fib(n-2) + fib(n-1)
        return cache[n]

    return _real_fib

fib = make_memoized_fib()
</code></pre>
<p>Here, in the same way, repeated calls to <code>fib</code> will share the same cache.</p>
</div>
</div>
<div aria-atomic="true" id="fib_local_cache_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question fib_local_cache -->
</p>
<p>OK, one major complaint handled.  However, you probably also noticed strong
similarities between the memoized Fibonacci and factorial functions.  Can we
factor the common parts out into some reusable ingredient?</p>
<p>One way to implement this would be to use a class, like so:</p>
<pre><code class="language-python">class MemoizedFunction:
    def __init__(self, func):
        self.func = func
        self.cache = {}

    def __call__(self, *args):
        if args not in self.cache:
            self.cache[args] = self.func(*args)
        return self.cache[args]
</code></pre>
<p>We've already seen most of the ingredients used here, though one new piece of
magic is the <code>__call__</code> method.  Whenever code tries to call some class
instance like a function, Python calls that instance's <code>__call__</code> method.  In
other words, we can define our own new function-like things by explaining what
it means to call them.</p>
<p>Another new piece of magic is the <code>*</code> syntax applied to a formal parameter, here called <code>*args</code>.
This allows the function to be called with any number of actual arguments, which are bundled up together into a <em>tuple</em> and bound to the formal parameter <code>args</code>.
(Note that there is nothing special about the name <code>args</code>.  It's just conventionally used for variable-length arguments like this, just as <code>self</code> is conventionally used for the self parameter.  And there's nothing special about using it in the <code>__call__</code> dunder method.  You can use <code>*</code> to handle variable-length arguments in any function you define.)</p>
<p>Finally, the code also uses <code>*args</code> in its body, but we've seen that before -- it's the <a href="flood_fill#_the_unpacking_operator">unpacking operator</a>, so it unpacks the tuple back into individual arguments for the wrapped function <code>func()</code>.</p>
<p>Now we can add memoization to the original, naive Fibonacci function, like so.</p>
<pre><code class="language-python">def fib(n):
    if n &lt; 2:
        return n
    return fib(n-2) + fib(n-1)
fib = MemoizedFunction(fib)
</code></pre>
<p>But, as we saw earlier on, it turns out we don't need classes to implement
generic memoization.  Functions are more than capable, too!</p>
<pre><code class="language-python">def memoize(func):
    cache = {}

    def _mfunc(*args):
        if args not in cache:
            cache[args] = func(*args)
        return cache[args]

    return _mfunc
</code></pre>
<p>Again, naive Fibonacci is easily memoized.</p>
<pre><code class="language-python">def fib(n):
    if n &lt; 2:
        return n
    return fib(n-2) + fib(n-1)
fib = memoize(fib)
</code></pre>
<p>This pattern is so common, of using a library function to augment a function
definition, that Python has special syntax for it.  We indicate what's called a
<strong>decorator</strong> by putting an "at" sign and a function name before another
function's definition.</p>
<pre><code class="language-python">@memoize
def fib(n):
    if n &lt; 2:
        return n
    return fib(n-2) + fib(n-1)
</code></pre>
<p>You may remember that we used the same trick in recitation, to instrument
functions to log all recursive calls to the screen.  Now you know that it's not
magic, and you are free to use the same trick in your own code!</p>
<p><script type="text/javascript">
catsoop.callbacks['submit'] = function(ok, names, status, response){
    response = JSON.parse(response);
    if (response[names[0]].score == 1){
        document.getElementById(names[0] + '_viewanswer').click();
    }
}
</script></p>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
catsoop.all_questions = ['all_caps_list', 'repeat_n_times', 'counter', 'fib_num_94', 'fib_local_cache'];
catsoop.username = 'gvargas1';
catsoop.this_path = 'https://py.mit.edu/spring24/readings/functional_programming';
catsoop.path_info = ['spring24', 'readings', 'functional_programming'];
catsoop.course = 'spring24';
catsoop.url_root = 'https://py.mit.edu';
catsoop.imp = '';
catsoop.skip_alert = ["all_caps_list", "repeat_n_times", "counter", "fib_num_94", "fib_local_cache"];
catsoop.viewans_confirm = "Are you sure?  Viewing the answer will prevent any further submissions to this question.  Press 'OK' to view the answer, or press 'Cancel' if you have changed your mind.";

// @license-end</script>
<div id="cs_footnotes" style="display:none;"></div>
</div>
</div>
<div class="cs_right_menu"></div>
</div>
<footer>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_bottom_navigation" id="cs_bottom_navigation"><li><a href="https://py.mit.edu/spring24">Home</a></li><li><a href="https://py.mit.edu/spring24/readings">Course Readings</a></li><li><a href="https://py.mit.edu/spring24/readings/functional_programming">Functional Programming</a></li></nav>
<div class="cs_footer">
      This page was last updated on Wednesday April 24, 2024 at 10:10:23 AM (revision <code>9ab5e725</code>).<br/> <br/>
<center><img src="https://py.mit.edu/_static/spring24/readings/cc-by-sa.svg" style="width: 2cm;"/></center><div style="max-width: 600px; margin-bottom:1em; margin-left:auto; margin-right:auto;">Except where otherwise noted, these readings are licensed under a<br/><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">Creative Commons BY-SA 4.0</a> license.  Portions of the readings were derived from<br/>or inspired by the <a href="https://web.mit.edu/6.031/www/sp24/" target="_blank">6.031 Course Notes</a>, the <a href="https://hz.mit.edu/catsoop/6.145" target="_blank">6.145 Course Notes</a>, and the 6.01 Course Notes.
</div>
<pre class="catsooplogo" style="font-size:50%;">\            
/    /\__/\  
\__=(  o_O )=
(__________) 
 |_ |_ |_ |_ </pre>
      Powered by <a href="https://catsoop.org" target="_blank">CAT-SOOP</a> v19.0.6+hg.3.118aecfb "Korat" (LTS) (development snapshot).<br/>
      CAT-SOOP is <a href="https://www.fsf.org/about/what-is-free-software" target="_blank">Free/Libre Software</a>, available under the terms<br/>of the <a href="https://py.mit.edu/_util/license" target="_blank">GNU Affero General Public License, version 3</a>.<br/>
<a download="" href="https://py.mit.edu/_util/source.zip" target="_blank">Download Source Code</a><br/>
<a href="https://py.mit.edu/_util/jslicense.html" rel="jslicense" target="_blank">Javascript License Information</a>
</div>
</footer>
</body>
</html>

