<!DOCTYPE html>

<html>
<head>
<!-- This page was generated by CAT-SOOP 19.0.6+hg.3.118aecfb.  miau. -->
<meta charset="utf-8"/>
<title>Backtracking | Course Readings | 6.101 Spring 2024</title>
<link href="https://py.mit.edu/_static/spring24/logo.gif" rel="icon" type="image/gif"/>
<!-- include catsoop base css -->
<link href="https://py.mit.edu/_static/_base/themes/base.css" rel="stylesheet" type="text/css"/>
<!-- set up JS namespace for catsoop -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    var catsoop = {plugins: {}};

    function toggleResponsiveHeader(){
        document.getElementsByTagName('header')[0].classList.toggle('responsive');
    }

    function toggleAttribute(elt, attr){
        elt.setAttribute(attr, elt.getAttribute(attr) === "true" ? "false" : "true");
    }

    catsoop.topMenuFocus = function(event) {
        var elt = event.target;
        var target = event.relatedTarget;
        if (elt.classList.contains('menu-submenu')){
            var topmenu = elt.parentNode.parentNode;
            if (target && !target.classList.contains("menu-submenu") && target !== topmenu.children[1]) {
                clearMenu(topmenu);
            }
        }else if (!target.classList.contains('cs_top_menu_item')){
            clearMenu(elt.parentNode);
        }
    }

    window.addEventListener('DOMContentLoaded', function(){
        var menu_boxes = document.getElementsByClassName('dropdown-checkbox');
        for(var i=0; i<menu_boxes.length; i++){
            menu_boxes[i].checked = false;
        }
    });

    function clearMenu(menu){
       menu.children[1].checked = false;
    }
    // @license-end
    </script>
<!-- dark mode -->
<script src="https://py.mit.edu/_static/_base/js/darkreader/darkreader.min.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.dark_mode_settings = null;
    if (catsoop.dark_mode_settings === null){
        catsoop.dark_mode_settings = JSON.parse(localStorage.getItem('catsoop_dark_mode_settings'));
        if (catsoop.dark_mode_settings === null){
            catsoop.dark_mode_settings = {'mode': 'disabled', 'brightness': 100, 'contrast': 90, 'sepia': 10, 'grayscale': 0};
        }
    }
    localStorage.setItem('catsoop_dark_mode_settings', JSON.stringify(catsoop.dark_mode_settings));
    catsoop.dark_mode = catsoop.dark_mode_settings.mode;
    delete catsoop.dark_mode_settings.mode;
    if (catsoop.dark_mode === 'enabled' || catsoop.dark_mode === 'auto'){
        DarkReader[catsoop.dark_mode == 'enabled' ? 'enable' : 'auto'](catsoop.dark_mode_settings);
    }
    
    document.addEventListener("DOMContentLoaded", function(event) {
        if (DarkReader.isEnabled()) {
            var invertfilter = 'invert(100%) hue-rotate(180deg)' +
                               ' brightness(' + catsoop.dark_mode_settings.brightness + '%)' +
                               ' contrast(' + catsoop.dark_mode_settings.contrast + '%)' +
                               ' grayscale(' + catsoop.dark_mode_settings.grayscale + '%)' +
                               ' sepia(' + catsoop.dark_mode_settings.sepia + '%)'
            var inverter = document.createElement('style');
            inverter.innerText = 'img.catsoop-darkmode-invert, video.catsoop-darkmode-invert {filter: ' + invertfilter + ';}\n\n'
            document.head.appendChild(inverter);
        }
    });
    // @license-end
    </script>
<!-- load in mathjax and CAT-SOOP-specific math rendering  -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    MathJax = {
      startup: {
        typeset: false,
      }
    }

    catsoop.render_math = function (elt) {
        if(elt.classList.contains('cs_displaymath')){
            var b = "\\[";
            var e = "\\]";
        }else{
            var b = "\\(";
            var e = "\\)";
        }
        elt.innerText = b + elt.innerText + e;
        MathJax.typeset([elt]);
        elt.classList.remove('cs_math_to_render');
    }


    catsoop.render_all_math = function (elt){
        if (elt === null) {
            return;
        }
        var mathelts = elt.getElementsByClassName('cs_math_to_render');
        while(mathelts.length > 0){
            catsoop.render_math(mathelts[0]);
        }
    }
    document.addEventListener("DOMContentLoaded", function(event) {
          catsoop.render_all_math(document);
    });
    // @license-end
    </script>
<script id="MathJax-script" src="https://py.mit.edu/_static/_base/js/mathjax/tex-chtml-full-speech.js"></script>
<!-- load in diagram stuff -->
<script src="https://py.mit.edu/_static/_base/js/cs_diagrams.js" type="text/javascript"></script>
<script type="text/javascript">
        catsoop.diagram_sources = {};
    </script>
<!-- Syntax Highlighting -->
<script src="https://py.mit.edu/_static/_base/js/highlight/highlight.min.js" type="text/javascript"></script>
<script src="https://py.mit.edu/_static/_base/js/highlightjs-line-numbers.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.syntax_highlighting = function (elt) {
        if (elt === null) {
            return;
        }
        elt.querySelectorAll('pre > code:not(.highlighted)').forEach((block) => {
            hljs.highlightBlock(block);
            var wrap = document.createElement("section");
            wrap.setAttribute("aria-label", "Code block");
            block.parentNode.replaceWith(wrap);
            wrap.append(block.parentNode);
            block.classList.add('highlighted');
        });
        elt.querySelectorAll('code.highlight-lines').forEach(function(b){
            hljs.lineNumbersBlock(b);
            if ((b.innerHTML.trim().match(/\r\n|\r|\n/g) || []).length > 0){
                b.parentElement.style = "padding-left: 0px !important;"
                b.classList.add('hljs');
            }
            b.classList.remove('highlight-lines');
        });
    }
    window.addEventListener('DOMContentLoaded', function(){
        catsoop.syntax_highlighting(document);
    });
    // @license-end
    </script>
<style>
      :root {
        --cs-base-bg-color: #0350ba;
        --cs-light-bg-color: #629ced;
        --cs-base-font-color: #fff;
        --cs-light-font-color: #000;
    }
    </style>
<style>
.cs_top_menu_item {
  font-size: 0.88rem;
}
div.dropdown {
  -moz-transform: translateY(-1px);
}
img {
  max-width:100% !important;
}
</style>
<style>
[id^=cs_qdiv].question-lab101 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101 [id$=nsubmits_left] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style2 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style2 [id$=nsubmits_left] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style1 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style1 [id$=nsubmits_left] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style3 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style3 [id$=nsubmits_left] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style4 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_style4 [id$=nsubmits_left] {
  display: none;
}
</style>
<style>
h2.cs_section_title {
   margin-top: 3em;
}
h3.cs_section_title {
   margin-top: 3em;
}
h4.cs_section_title {
   margin-top: 2em;
}
code.hljs {
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
img.envdia {
  border-radius: 5px;
  border: 2px #ccc solid;
}
img.pixels {
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}
button[id$=clearanswer] {
  display: none;
}
.flex { display: flex; flex-wrap: wrap; }
.flex > pre { flex: 1; }
.flex > img { flex: 0 1; }
</style>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function (){
    document.querySelectorAll("img.envdia").forEach(function (b){
        b.classList.add("catsoop-darkmode-invert")
    });
});
</script>
<script src="https://py.mit.edu/_static/spring24/readings/multistep.js" type="text/javascript"></script>
<link href="https://py.mit.edu/_static/spring24/readings/multistep.css" rel="stylesheet"/>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.addEventListener("DOMContentLoaded", function(){
    sessionStorage.setItem("last-non-settings", catsoop.this_path);
});
// @license-end
</script>
<script src="https://py.mit.edu/_static/_base/js/codemirror/codemirror.bundle.min.js" type="text/javascript"></script>
<script src="https://py.mit.edu/_static/_handler/default/cs_ajax.js" type="text/javascript"></script>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
</head>
<body style="margin: 0px;">
<header id="cs_header">
<div aria-role="menubar" class="nav-container">
<div class="cs_header_text"><a href="https://py.mit.edu/spring24"><img src="https://py.mit.edu/_static/spring24/logo.gif"/> 6.101</a></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_a47c0b052b07cf284d5c1a10c5c01779">Information<span aria-hidden="true" class="downarrow">▼</span></label>
<input checked="false" class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_a47c0b052b07cf284d5c1a10c5c01779" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox"/>
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/basics" onblur="catsoop.topMenuFocus(event);" role="menuitem">Basics and Schedule</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/grading" onblur="catsoop.topMenuFocus(event);" role="menuitem">Grading Policies</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/academic_integrity" onblur="catsoop.topMenuFocus(event);" role="menuitem">Academic Integrity</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/help" onblur="catsoop.topMenuFocus(event);" role="menuitem">Getting Help</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/info/staff" onblur="catsoop.topMenuFocus(event);" role="menuitem">Staff List</a></div></div>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring24/readings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Readings</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring24/queue" onblur="catsoop.topMenuFocus(event);" role="menuitem">Queue</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring24/progress" onblur="catsoop.topMenuFocus(event);" role="menuitem">Progress</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring24/infrastructure" onblur="catsoop.topMenuFocus(event);" role="menuitem">Infrastructure</a>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_c3b9e530d4d3883e69a8f3fd30ad0e84">gvargas1<span aria-hidden="true" class="downarrow">▼</span></label>
<input checked="false" class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_c3b9e530d4d3883e69a8f3fd30ad0e84" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox"/>
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/ssh_keys" onblur="catsoop.topMenuFocus(event);" role="menuitem">Manage SSH Keys</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/_util/user_settings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Settings</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring24/readings/backtracking?loginaction=logout" onblur="catsoop.topMenuFocus(event);" role="menuitem">Log Out</a></div></div><a class="icon" href="javascript:void(0);" onclick="toggleResponsiveHeader()">☰</a>
</div>
</header>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_top_navigation" id="cs_breadcrumbs"><li><a href="https://py.mit.edu/spring24">Home</a></li><li><a href="https://py.mit.edu/spring24/readings">Course Readings</a></li><li><a href="https://py.mit.edu/spring24/readings/backtracking">Backtracking</a></li></nav>
<div class="cs_body" id="cs_body">
<div class="cs_left_menu"></div>
<div class="cs_content">
<div class="cs_page_body" role="main">
<center><h1 class="cs_content_header">Recursive Backtracking</h1></center>
<div class="callout callout-warning" markdown="">
<p>This reading is relatively new, and your feedback will help us
improve it!  If you notice mistakes (big or small), if you have questions, if
anything is unclear, if there are things not covered here that you'd like to
see covered, or if you have any other suggestions; please get in touch during
office hours or open lab hours, or via e-mail at <code>6.101-help@mit.edu</code>.</p>
</div>
<h2 aria-hidden="true">Table of Contents</h2><ul aria-label="Table of Contents" role="navigation"><li><a href="#_introduction">1) Introduction</a></li><li><a href="#_the_mixtape">2) The Mixtape</a></li><li><a href="#_an_alternative_approach">3) An Alternative Approach</a></li><li><a href="#_yet_another_approach">4) Yet Another Approach</a></li><li><a href="#_an_iterative_mixtape_version">5) An Iterative Mixtape Version</a></li><ul><li><a href="#_a_note_on_efficiency">5.1) A note on efficiency</a></li></ul><li><a href="#_sudoku">6) Sudoku</a></li><ul><li><a href="#_improving_efficiency">6.1) Improving Efficiency</a></li><li><a href="#_improving_efficiency_mutation">6.2) Improving Efficiency: Mutation</a></li></ul><li><a href="#_summary">7) Summary</a></li></ul>
<p><a class="anchor" name="catsoop_section_1"></a><a class="anchor" name="_introduction"></a><h2 class="cs_section_title">1) Introduction<a class="cs_permalink" href="#_introduction">§</a></h2></p>
<p>Many problems can be solved by a trial-and-error method. <a href="https://en.wikipedia.org/wiki/Bertrand_Russell">Bertrand Russell</a>, a
famous mathematical logician of the 20th century, suggested that a bunch of
monkeys banging away randomly at typewriters in the basement of the British
Museum might eventually reproduce the text of Shakespeare's Hamlet if they
work long enough. Computer scientists thus talk about the <em>British Museum
Algorithm</em> as a baseline way to solve any problem for which all possible
solutions can be enumerated: just try them all until one succeeds.</p>
<p>Computers are thought of as being really good at this kind of
drudgery, but even their speed is daunted by large problems. For
example, Hamlet contains 29,551 words, according to Wikipedia, and
Shakespeare's known writings contain about 31,000 unique
words. So, to generate Hamlet, our computer might use the
following strategy to type a text that turns out to be Hamlet:</p>
<ul>
<li>While the story is shorter than Hamlet (in word count), try
extending it by each one of the words in Shakespeare's vocabulary.</li>
<li>If the story is equal to Hamlet, stop and declare success.</li>
</ul>

<!--
Something like this might be implemented as the generator function `bm` in the code
below. Using a tiny vocabulary and a goal story of only four words, this would
still not find the correct story until the 1441-st try.

```py
vocabulary = 'I am Hamlet the prince of Denmark'.split()
goal = 'the prince am I'.split()

def bm(story, vocabulary, goal):
    yield story
    if len(story) < len(goal):
        for w in vocabulary:
            yield from bm(story + [w], vocabulary, goal)

for index, story in enumerate(bm([])):
    print(index, story)
    if story == goal:
        break


bm([])
1 []
2 ['I']
3 ['I', 'I']
4 ['I', 'I', 'I']
5 ['I', 'I', 'I', 'I']
6 ['I', 'I', 'I', 'am']
7 ['I', 'I', 'I', 'Hamlet']
8 ['I', 'I', 'I', 'the']
9 ['I', 'I', 'I', 'prince']
10 ['I', 'I', 'I', 'of']
11 ['I', 'I', 'I', 'Denmark']
12 ['I', 'I', 'am']
...
1441 ['the', 'prince', 'am', 'I']
```

<div class="question"><b>Check Yourself:</b><p>How many possible "stories" could the above program generate for a goal of four
words?</p><p><span id="queue_checkyourself_1"></span></p></div>
-->
<!--
log_10 31000^29551 = 29551 log 31000 = 29551 * 4.49136 = 132724.229414
-->
<p>Unfortunately, the expected running time of this process is proportional to
the number of possible stories with the same number of words as Hamlet ---
which would be <span class="cs_math_to_render">31000^{29551}</span>, or roughly <span class="cs_math_to_render">10^{132724}</span> possible stories. No
super-fast computer running for the lifetime of the universe could complete
this task. For more realistic approaches, constraints along the way in
examining possible solutions can dramatically cut down on such giant problems
by cutting off lines of exploration as soon as they can be shown not to lead to
solutions.</p>
<p>For example, if we had a perfect grammar checker for Elizabethan English, we
could stop exploring a story as soon as we hit an ungrammatical patch in its
construction.</p>
<p>In this reading, we explore methods to solve complex problems using recursion
to reduce a larger problem to a number of smaller ones by trying each possible
next step toward a solution and seeing if the resulting subproblem is solvable.</p>
<p><a class="anchor" name="catsoop_section_2"></a><a class="anchor" name="_the_mixtape"></a><h2 class="cs_section_title">2) The Mixtape<a class="cs_permalink" href="#_the_mixtape">§</a></h2></p>
<p><a href="https://en.wikipedia.org/wiki/Cassette_tape">The compact cassette tape</a>, developed by Philips in the early 1960s, democratized
music recording by allowing anyone with a relatively inexpensive cassette
recorder to record or copy music and to share it with friends. A popular
use of these tapes was to create a <em>mixtape</em>, copying songs perhaps from a
variety of sources onto a collection that had special meaning. Gifts of
mixtapes were common, so a tape of love songs could musically express feelings
that a person might find difficult to share otherwise.</p>
<p>Here is an example of a tape one of the instructors made a long time ago:</p>
<center>
<img src="https://py.mit.edu/_static/spring24/readings/backtracking/cassette.jpg"/>
</center>
<p>Each tape, unlike today's almost infinite digital repositories, had a limited
capacity (60 minutes in the image, which means 30 minutes on each side of the
tape), and we were driven to include as much music as possible on a tape. So,
the mixtape problem was defined as:</p>
<ul>
<li>from a collection of songs, choose a set that comes closest to filling a tape.</li>
</ul>
<p>We use a variant of this problem in this reading, namely choosing a set of
songs for a mixtape that exactly fills the capacity of (one side of) the tape.
We will represent the collection of songs by a <code>dict</code> whose keys are the song
titles and whose values are the lengths of the songs (in minutes). The function
<code>mixtape</code>, then, is called with a song collection and the target duration:</p>
<pre><code class="language-py">def mixtape(songs, target_duration):
    """
    Given a dictionary of songs (mapping titles to durations), as well as a
    total target duration, return a set of song titles such that the sum of
    those songs' durations equals the target_duration.

    If no such set exists, return None instead.

    &gt;&gt;&gt; songs = {'A': 5, 'B': 10, 'C': 6, 'D': 2}
    &gt;&gt;&gt; mixtape(songs, 21) == {'A', 'B', 'C'}
    True
    &gt;&gt;&gt; mixtape(songs, 1000) is None
    True
    """
    raise NotImplementedError


if __name__ == '__main__':
    import doctest
    doctest.testmod()
</code></pre>
<p>This code is included in <a href="https://py.mit.edu/_static/spring24/readings/backtracking/mixtape.zip"><code>mixtape.zip</code></a>,
which you can use to follow along if you're interested.  This file also includes
several test cases and a <code>test.py</code> file.</p>
<p>Note the doctest, which specifies that we should be able to fill 21 minutes
using songs <code>'A'</code>, <code>'B'</code> and <code>'C'</code>, but that we cannot fill a tape with a
duration of 1000 minutes (there just aren't enough songs in our collection).</p>
<p><em>A note on the doctest</em>: Normally, we might write the first test as</p>
<pre><code class="language-py">    &gt;&gt;&gt; mixtape(songs, 21)
    {'A', 'B', 'C'}
</code></pre>
<p>but because Python does not guarantee to print the elements of a set in any
particular order, we instead test for set equality and expect the result to
print as <code>True</code>.</p>
<p>We approach this problem using recursion, which the previous readings covered.
In such an approach, we need to identify any base case(s), which can be solved
without further recursion, and the recursive case(s), where we can solve a
smaller version of the problem to build up the solution to the original.</p>
<div class="question"><b>Check Yourself:</b><p><p>What base case(s) do you recognize in the mixtape problem?</p>
<p>How would recursion allow the solution of a subproblem to build the solution to the original problem?
</p></p><p><span id="queue_checkyourself_2"></span></p></div>
<p>Let's first focus on the recursive problem, using the trial-and-error approach.
The basic idea is to pick one of the songs in the song list and assume that it
will be part of the mixtape. That leaves us the problem of filling the rest of
the tape (the remaining duration after subtracting the length of the chosen
song) with the remaining songs.</p>
<p>Our first approach to implementing this idea in code might look as follows:</p>
<pre><code class="language-py">    song = list(songs.keys())[0] # pick an arbitrary song
    duration = songs[song]
    return {song} | mixtape({k: v for k, v in songs.items() if k != song},
                            target_duration - duration)
</code></pre>
<p>The <code>|</code> operator is being used here to take the <a href="https://docs.python.org/3/library/stdtypes.html#frozenset.union">union of two sets</a>.</p>
<p>So, the answer to the recursive case is a set of songs, including the chosen
song and the set chosen for the subproblem of filling the remaining duration.
You will see that we'll need to tweak this a bit, but it's the right basic
idea.</p>
<p>To construct the <code>dict</code> of songs remaining for the subproblem, we used a dictionary
comprehension, iterating over each of the key/value pairs in <code>songs</code> and
including all the ones except the chosen song.  In case that format is new,
it's worth mentioning that the following is an alternative that accomplishes
the same goal:</p>
<pre><code class="language-py">    new_songs = dict(songs)
    del new_songs[song]
    return {song} | mixtape(new_songs, target_duration - duration)
</code></pre>
<p>This code avoids the dict comprehension, but it's critical to copy
<code>songs</code>, because <code>del</code> mutates the dict it works on.  Moving forward, we'll
stick with the dictionary-comprehension-based approach since it makes it
clearer that a copy is being made.</p>
<p>Observing that the target duration decreases on each recursive call gives us a
clue about what a base case might be. If the <code>target_duration == 0</code>, then we
have solved the problem and need to add no more songs to the solution set, so
we can return the empty set.  With this in mind, the body of the mixtape
function would look like this:</p>
<pre><code class="language-py">    if target_duration == 0:
        return set()

    song = list(songs.keys())[0]
    duration = songs[song]
    return {song} | mixtape({k: v for k, v in songs.items() if k != song},
                            target_duration - duration)
</code></pre>
<p>You could try to run this version of the program with the doctest, but you will
see that, although the first example succeeded, the second failed:</p>
<pre><code class="nohighlight">Failed example:
    mixtape(songs, 1000) is None
</code></pre>
<p>You'll see an error message saying that <code>IndexError: list index out of range</code>
in the line <code>song = list(songs.keys())[0]</code>.</p>
<p>
<!--START question first_error_decoding --><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_first_error_decoding" style="position: static">
<div id="first_error_decoding_rendered_question">
<div id="catsoop_preamble_first_error_decoding"></div>
<div id="catsoop_prompt_first_error_decoding" style="display: inline;">What is the core issue that leads to this error?<br/></div><div aria-labelledby="catsoop_prompt_first_error_decoding" role="radiogroup">
<div style="margin-bottom: 10px;"><input id="first_error_decoding_opts_0" name="first_error_decoding_opts" type="radio" value="0"/><label for="first_error_decoding_opts_0"><code>list</code> makes a new list containing <code>song.keys()</code> as a single element.  We should use <code>[songs.keys()]</code> instead.</label></div>
<div style="margin-bottom: 10px;"><input id="first_error_decoding_opts_1" name="first_error_decoding_opts" type="radio" value="1"/><label for="first_error_decoding_opts_1"><code>songs.keys()</code> can't be converted to a list.</label></div>
<div style="margin-bottom: 10px;"><input checked="" id="first_error_decoding_opts_2" name="first_error_decoding_opts" type="radio" value="2"/><label for="first_error_decoding_opts_2"><code>songs</code> is empty.</label></div>
<div style="margin-bottom: 10px;"><input id="first_error_decoding_opts_3" name="first_error_decoding_opts" type="radio" value="3"/><label for="first_error_decoding_opts_3">Indexing into <code>songs.keys()</code> is impossible.</label></div>
</div><input id="first_error_decoding" name="first_error_decoding" type="hidden" value="2"/>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.querySelectorAll("input[type=radio][name=first_error_decoding_opts]").forEach(function(r){
    r.addEventListener("click", function(){
        document.getElementById("first_error_decoding").value = this.value;
    });
});
// @license-end
</script>
</div><div>
<span id="first_error_decoding_buttons">
<button class="submit btn btn-catsoop" id="first_error_decoding_submit" onclick="catsoop.submit('first_error_decoding');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="first_error_decoding_clearanswer" onclick="catsoop.clearanswer('first_error_decoding');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="first_error_decoding_loading_wrapper" role="status">
<span id="first_error_decoding_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="first_error_decoding_score_display" role="status"></span>
<div class="nsubmits_left" id="first_error_decoding_nsubmits_left" role="status">You have submitted this assignment 4 times.</div></div>
<div class="solution" id="first_error_decoding_solution_container">
<div id="first_error_decoding_solution">
<b>Solution:</b> <code>songs</code> is empty.
</div>
<div id="first_error_decoding_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>With each recursive call, it's not only the case that <code>target_duration</code> is
getting smaller; <code>songs</code> is getting smaller as well!  On each recursive call,
we have one fewer song in the dictionary.</p>
<p>Eventually, we reach the case where <code>songs</code> is empty.  In that case,
<code>list(songs.keys())</code> will be an empty list <code>[]</code>, and so looking up index 0
inside of that list fails!</p>
</div>
</div>
<div aria-atomic="true" id="first_error_decoding_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question first_error_decoding -->
</p>
<p>This suggests a second base case: if we run out of songs when we still
have <code>target_duration</code> to fill.</p>
<pre><code class="language-py">    if not songs:
        return _______ # &lt; -- something
</code></pre>
<p>
<!--START question failure_base_case_return --><section aria-label="Question">
<div class="question question-smallbox" id="cs_qdiv_failure_base_case_return" style="position: static">
<div id="failure_base_case_return_rendered_question">
<div id="catsoop_preamble_failure_base_case_return"></div>
<div id="catsoop_prompt_failure_base_case_return" style="display: inline;">Given the specification of <code>mixtape</code> from its docstring, what should go in the blank above?<br/></div><input aria-labelledby="catsoop_prompt_failure_base_case_return" id="failure_base_case_return" name="failure_base_case_return" type="text" value="None">
</input></div><div>
<span id="failure_base_case_return_buttons">
<button class="submit btn btn-catsoop" id="failure_base_case_return_submit" onclick="catsoop.submit('failure_base_case_return');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="failure_base_case_return_clearanswer" onclick="catsoop.clearanswer('failure_base_case_return');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="failure_base_case_return_loading_wrapper" role="status">
<span id="failure_base_case_return_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="failure_base_case_return_score_display" role="status"></span>
<div class="nsubmits_left" id="failure_base_case_return_nsubmits_left" role="status">You have submitted this assignment 3 times.</div></div>
<div class="solution" id="failure_base_case_return_solution_container">
<div id="failure_base_case_return_solution">
<b>Solution:</b> None
</div>
<div id="failure_base_case_return_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="failure_base_case_return_message" role="status"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question failure_base_case_return -->
</p>
<p>Now that we have changed our base case(s), we need to adjust our recursive case
as well.  Previously, we had been acting under the assumption that our
recursive result would always be a set.  But now that's no longer true!  So
let's adjust our code to try to account for this:</p>
<pre><code class="language-py">    recursive_result = mixtape({k: v for k, v in songs.items() if k != song},
                               target_duration - duration)
    if recursive_result:
        return {song} | recursive_result
    else:
        return None
</code></pre>
<p>
<!--START question truthiness_bug --><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_truthiness_bug" style="position: static">
<div id="truthiness_bug_rendered_question">
<div id="catsoop_preamble_truthiness_bug"></div>
<div id="catsoop_prompt_truthiness_bug" style="display: inline;">After making this change, what will happen when running the first
doctest, <code>mixtape(songs, 21)</code>?<br/></div>
<select aria-labelledby="catsoop_prompt_truthiness_bug" id="truthiness_bug" name="truthiness_bug">
<option value="-1">--</option>
<option value="0">It will return the correct result, {'A', 'B', 'C'}.</option>
<option selected="" value="1">It will run to completion but it will return an incorrect result.</option>
<option value="2">It will enter an infinite loop.It will start an infinite recursion (resulting in a RecursionError exception).</option>
<option value="3">It will raise a different kind of exception.</option>
<option value="4">Something else.</option></select>
</div><div>
<span id="truthiness_bug_buttons">
<button class="submit btn btn-catsoop" id="truthiness_bug_submit" onclick="catsoop.submit('truthiness_bug');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="truthiness_bug_clearanswer" onclick="catsoop.clearanswer('truthiness_bug');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="truthiness_bug_loading_wrapper" role="status">
<span id="truthiness_bug_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="truthiness_bug_score_display" role="status"></span>
<div class="nsubmits_left" id="truthiness_bug_nsubmits_left" role="status">You have submitted this assignment 1 time.</div></div>
<div class="solution" id="truthiness_bug_solution_container">
<div id="truthiness_bug_solution">
<b>Solution:</b> It will run to completion but it will return an incorrect result.
</div>
<div id="truthiness_bug_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>We expect the sequence of recursive calls with the following arguments:</p>
<pre><code class="language-py">{'A': 5, 'B': 10, 'C': 6, 'D': 2}, 21
{'B': 10, 'C': 6, 'D': 2}, 16
{'C': 6, 'D': 2}, 6
{'D': 2}, 0
</code></pre>
<p>and we expect the recursive calls to return</p>
<pre><code class="language-py">set()
{'C'}
{'C', 'B'}
{'C', 'B', 'A'}
</code></pre>
<p>Try adding statements to print the return value of each call just before we
return it.  What do you see, and how does it differ from what we expect?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>Instead of the expected
<pre><code class="language-py">set()
{'C'}
{'C', 'B'}
{'C', 'B', 'A'}
</code></pre>
<p>we see:</p>
<pre><code class="language-py">set()
None
None
None
</code></pre>
<p>(Remember that you will eventually need to comment out or remove these debugging print statements, because <a href="recursion/#_aside_doctest">doctest can't handle unexpected output</a>.)
</p></div></div>
<div class="question"><b>Check Yourself:</b><p><p>Can you see where our coding style inadvertently does the wrong thing?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>Note that we've got two different possible return values from our two separate
base cases: if the tape is already full, we return <code>set()</code>.  This indicates a
<em>trivial success</em>; that is, we've already accomplished our goal of filling the
tape, and no new songs are necessary!  In our other base case, where we've run
out of songs, we return <code>None</code>, which indicates <em>failure</em>.  These two values
mean very different things!
<p>The problem with our code above is that we used <code>if recursive_result</code> assuming
that it would fail only on <code>None</code>. However, Python considers many other values
to be "falsy," including <code>[]</code>, <code>0</code>, and <code>set()</code>.</p>
<p>Thus, when a recursive call returns <code>set()</code> (which should be treated as a
success!), our code treats it as a failure instead.</p>
<p>We can fix this by testing not for truthiness but explicitly for <code>None</code>:</p>
<pre><code class="language-py">    if recursive_result is not None:
        return {song} | recursive_result
</code></pre>
<p>(Note that careful Python programmers use <code>is None</code> or <code>is not None</code> for this kind of test, rather than <code>== None</code> or <code>!= None</code>.  There's no real difference if you're only working with built-in types like lists, sets, and strings, but once you have custom types (which we discuss in a future reading), the meaning of <code>==</code> and <code>!=</code> might be different than you expect.  You can read <a href="http://jaredgrubb.blogspot.com/2009/04/python-is-none-vs-none.html">more about the difference between <code>is None</code> and <code>== None</code></a>.)</p></div></div>
</p><p><span id="queue_checkyourself_1"></span></p></div>
</div>
</div>
<div aria-atomic="true" id="truthiness_bug_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question truthiness_bug -->
</p>
<p>After having made the change recommended in the explanation of the exercise just above, the code now passes both test cases.  So are we
done?  Well, from the tone of this reading, you might well guess: No!</p>
<p>Passing two test cases is great, and we shouldn't discount the progress we've
made so far.  However, passing those two test cases (in fact, passing <em>any</em>
number of test cases) isn't really a perfect guarantee that our code is working
as expected.  So we've got some more work to do.</p>
<div class="question"><b>Check Yourself:</b><p><p>Despite passing the two tests in the docstring, our code will still fail in
some cases.  Can you construct a different test case that would show a
remaining error?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>A simple test case to illustrate that our program is still not quite right is
to add the doctest:
<pre><code class="language-py">&gt;&gt;&gt; mixtape(songs, 10) == {'B'}
True
</code></pre>
<p>This fails, printing nothing (which indicates that instead of the expected
answer, our code is returning <code>None</code>).</p></div></div>
</p><p><span id="queue_checkyourself_3"></span></p></div>
<p>Our algorithm, so far, actually does not explore all possibilities. When we
chose <code>list(songs.keys())[0]</code> as the next song to try to use, our recursive
call assumed that that song was part of the solution.  So we're failing
to consider any solution that doesn't include that first song!</p>
<p>So in some sense, it worked for our previous example only because we got lucky
(because the first three songs chosen happened to fill the tape).  In reality,
we need to consider a couple of different possibilities in our recursive case(s):</p>
<ol>
<li>The first song chosen is part of a solution, and we can solve the subproblem of filling the rest of the time.</li>
<li>That song <em>is not</em> part of a solution.  In this case, rather than assuming that there is no solution, we ought to consider possibilities <em>that don't include that song</em>.</li>
</ol>
<p>This method shows the essence of <em>backtracking</em>: try something, and if it does
not work, try another alternative.  This should resonate with what you remember
from the <a href="https://py.mit.edu/spring24/readings/recursion2#_tree_like_patterns">recursion reading</a> about searching trees of possibilities.</p>
<p>We implement this as follows:</p>
<pre><code class="language-py">def mixtape(songs, target_duration):
    """
    Given a dictionary of songs (mapping titles to durations), as well as a
    total target duration, return a set of song titles such that the sum of
    those songs' durations equals the target_duration.

    If no such set exists, return None instead.

    &gt;&gt;&gt; songs = {'A': 5, 'B': 10, 'C': 6, 'D': 2}
    &gt;&gt;&gt; mixtape(songs, 21) == {'A', 'B', 'C'}
    True
    &gt;&gt;&gt; mixtape(songs, 1000) is None
    True
    &gt;&gt;&gt; mixtape(songs, 10)
    {B}
    """
    if target_duration == 0:
        return set()

    if not songs:
        return None

    song = list(songs.keys())[0]
    songs_rest = {k: v for k, v in songs.items() if k != song}
    duration = songs[song]

    # if the first song is part of a solution, we can fill the remaining space
    # on the tape with the other songs
    recursive_result1 = mixtape(songs_rest, target_duration - duration)
    if recursive_result1 is not None:
        return {song} | recursive_result1

    # if the first song is not part of the solution, we should try to fill the
    # _whole_ duration with the other songs
    recursive_result2 = mixtape(songs_rest, target_duration)
    if recursive_result2 is not None:
        return recursive_result2

    # if there is no solution with the first song, and no solution without it,
    # then there must be no solution.  it's only now that we can safely return
    # None to indicate failure.
    return None
</code></pre>
<p>The first recursive case tests if we can solve the problem by including the
selected song, and the second case tests if we can solve it by excluding that song.</p>
<p>This version does now solve the problem, though additional minor changes could
improve it. For example, once the <code>target_duration</code> becomes negative, no
solution on that path is possible, so we could adjust the failure case as follows:</p>
<pre><code class="language-py">    if target_duration &lt; 0 or not songs:
        return None
</code></pre>
<p>Without this change, the code would <em>theoretically</em> work, but finding a failure
case could take a <em>really</em> long time for cases where there is no solution.</p>
<p><a class="anchor" name="catsoop_section_3"></a><a class="anchor" name="_an_alternative_approach"></a><h2 class="cs_section_title">3) An Alternative Approach<a class="cs_permalink" href="#_an_alternative_approach">§</a></h2></p>
<p>This latest version is a pure recursive solution, but some mixture of recursion
and iteration is also possible. For example, instead of recursing on the
"exclude this song" case, we could iterate over which song to include:</p>
<pre><code class="language-py">def mixtape(songs, target_duration):
    """
    Given a dictionary of songs (mapping titles to durations), as well as a
    total target duration, return a set of song titles such that the sum of
    those songs' durations equals the target_duration.

    If no such set exists, return None instead.

    &gt;&gt;&gt; songs = {'A': 5, 'B': 10, 'C': 6, 'D': 2}
    &gt;&gt;&gt; mixtape(songs, 21) == {'A', 'B', 'C'}
    True
    &gt;&gt;&gt; mixtape(songs, 1000) is None
    True
    &gt;&gt;&gt; mixtape(songs, 10)
    {B}
    """
    if target_duration == 0:
        return set()

    if not songs:
        return None

    for song, duration in songs.items():
        recursive_result = mixtape({k: v for k, v in songs.items() if k != song},
                                   target_duration - duration)
        if recursive_result is not None:
            return {song} | recursive_result
    return None
</code></pre>
<p>Here, we try each song in turn and return success if we can recursively
succeed in filling the tape with others. Instead of failing if the first song
does not work, we continue to try others, and we only fail if we have run through
all the songs and none of them worked. Note that, strictly speaking, the
<code>return None</code> at the end is not needed since any Python function that "falls
through" its end automatically returns <code>None</code>, but in this case it is helpful
to the reader to be explicit.</p>
<!--
<div class="question"><b>Check Yourself:</b><p>Do you feel more comfortable with the purely recursive solution or the partly iterative one?</p><p><span id="queue_checkyourself_4"></span></p></div>
-->
<p>It is an often-used but dangerous assumption by programmers that a program that
passes a handful of test cases must surely be correct. Passing more test cases
can increase your confidence, especially if the test cases were crafted well to
test a variety of situations, but it always remains possible to fail to
anticipate a case on which the program might fail.  There are techniques of
proving program correctness under all possible cases, but that is a more
advanced topic, for a later subject in your curriculum.</p>
<p>We have included 25 other, larger test cases in the code distribution, which
you can run by invoking</p>
<pre><code class="nohighlight">pytest test.py
</code></pre>
<p><a class="anchor" name="catsoop_section_4"></a><a class="anchor" name="_yet_another_approach"></a><h2 class="cs_section_title">4) Yet Another Approach<a class="cs_permalink" href="#_yet_another_approach">§</a></h2></p>
<p>We've seen a couple of alternative approaches already, but let's look at
another couple of ways we could solve this problem before we move on to
another example.</p>
<p>First, we focus on a method that you saw in some of our earlier code on
recursion. In our solution above, we dive down into subproblems that, if solved
successfully, return part of the answer (starting with an empty set by default,
which could just as well be an immutable <code>frozenset</code>) and build up
the entire answer as they return to higher levels of the recursion. Here we
will consider an alternative in which the possible answer is constructed on the
way down instead.</p>
<p>We accumulate in the set <code>so_far</code> the songs we have chosen to that point. The
success base case is if their total duration equals the target, and the failure
case is if that total exceeds the target. We follow the approach of iterating
over all the songs and seeing if we can solve the recursive problem by adding
that song to the <code>so_far</code> set in the recursion.</p>
<pre><code class="language-py">def mixtape(songs, target_duration, so_far = frozenset()):
    so_far_duration = sum(songs[s] for s in so_far)
    if so_far_duration == target_duration:
        return ______  # &lt; -- what should go here?

    if so_far_duration &gt; target_duration:
        return None

    for song, duration in songs.items():
        recursive_result = mixtape(songs, target_duration, so_far | {song})
        if recursive_result is not None:
            return recursive_result
    return None
</code></pre>
<p>Notice that we have equivalent checks to our base cases from our earlier
version of the code here.  Which parts match up?  How are they different and
how are they similar?</p>
<p>
<!--START question so_far_return --><section aria-label="Question">
<div class="question question-smallbox" id="cs_qdiv_so_far_return" style="position: static">
<div id="so_far_return_rendered_question">
<div id="catsoop_preamble_so_far_return"></div>
<div id="catsoop_prompt_so_far_return" style="display: inline;">What should go in the blank above?<br/></div><input aria-labelledby="catsoop_prompt_so_far_return" id="so_far_return" name="so_far_return" type="text" value="so_far"/>
</div><div>
<span id="so_far_return_buttons">
<button class="submit btn btn-catsoop" id="so_far_return_submit" onclick="catsoop.submit('so_far_return');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="so_far_return_clearanswer" onclick="catsoop.clearanswer('so_far_return');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="so_far_return_loading_wrapper" role="status">
<span id="so_far_return_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="so_far_return_score_display" role="status"></span>
<div class="nsubmits_left" id="so_far_return_nsubmits_left" role="status">You have submitted this assignment 5 times.</div></div>
<div class="solution" id="so_far_return_solution_container">
<div id="so_far_return_solution">
<b>Solution:</b> so_far
</div>
<div id="so_far_return_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>In this version of the code, we add the song we're considering to the
<code>so_far</code> set that we pass in to the recursive call.  So by the time we
hit our base case, we have all the songs we need (i.e., <code>so_far</code> represents
the solution to the original problem).  So we should just return <code>so_far</code>.</p>
<p>In every case, the caller simply returns whatever the recursive call returned,
so this result will ultimately be the value we return from the top-level call.</p>
</div>
</div>
<div aria-atomic="true" id="so_far_return_message" role="status"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question so_far_return -->
</p>
<p>Sadly, even with the right value in the blank, testing this on the doctests
(not shown here to save space) fails with a <code>RecursionError</code>. Why?
When we pass <code>songs</code> down to our recursive cases, the iteration will
always start by trying to add the same first song to <code>so_far</code>.  Since adding the
same element to a set does not change the set, each recursive subproblem
is just identical to the previous problem, so this would lead to an infinite regress.
When it reaches Python's recursion limit, Python cuts it off and raises <code>RecursionError</code>.</p>
<p>This problem is relatively easy to fix by adding a test to the iteration so we
skip over songs that are already in <code>so_far</code>:</p>
<pre><code class="language-py">        if song in so_far:
            continue
</code></pre>
<p>Remember that <code>continue</code> tells Python just to go on to the next iteration of
the <code>for</code> loop.</p>
<p>This version now solves the problem.</p>
<div class="question"><b>Check Yourself:</b><p><p>Unlike in our previous solution, we used no base case to check if we are out of
other songs to try.  Why does this code work despite not having that piece of
code represented explicitly?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>In this code, if all the songs are already in <code>so_far</code>, we
just fall through the <code>for</code> loop and return <code>None</code> for failure. But the same
idea would also apply in our previous program, so the base case
<pre><code class="language-py">    if not songs:
        return None
</code></pre>
<p>is actually redundant and could be dropped. It probably <em>should</em> be dropped,
since more lines of code generally leads to more opportunities for errors.</p></div></div>
</p><p><span id="queue_checkyourself_5"></span></p></div>
<p><a class="anchor" name="catsoop_section_5"></a><a class="anchor" name="_an_iterative_mixtape_version"></a><h2 class="cs_section_title">5) An Iterative Mixtape Version<a class="cs_permalink" href="#_an_iterative_mixtape_version">§</a></h2></p>
<p>In our reading on graph search, we saw that it is possible, and often helpful,
to maintain an agenda that keeps track of the program's state and its plans
for what paths to search in the future.  Here, we will develop a version of
<code>mixtape</code> that takes just this approach.  Then, we'll use this as a jumping-off
point for a discussion of the similarities and differences between the
recursive and iterative solutions to this problem.</p>
<div class="question"><b>Check Yourself:</b><p><p>Try to think about how we can use the agenda-based approach to construct a
solution to this problem.  Can you think of how the code might be structured?
What will the elements in our agenda represent?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>Here is a working implementation of this idea (omitting the comment and
doctests to save space):
<pre><code class="language-py">def mixtape(songs, target_duration):
    agenda = [set()]
    while agenda:
        this_mixtape = agenda.pop()
        duration = sum(songs[s] for s in this_mixtape)
        if duration == target_duration:
            return this_mixtape
        if duration &gt; target_duration:
            continue
        for song in songs:
            if song not in this_mixtape:
                agenda.append(this_mixtape | {song})
    return None
</code></pre>
<p>Each element in our agenda represents a possible solution to the problem, in
the form of a set of songs.  As we pull possibilities from the agenda, we
check the length of each:</p>
<ul>
<li>If it's the right length, we just return it (this is equivalent to the "success" base case in our recursive version).</li>
<li>If it's too long, then we skip it, since neither it nor its descendents can possibly solve the problem (this is equivalent to at least part of our "failure" base case from above).</li>
<li>If it's too short, we skip it but we add related sets to the agenda, each containing one more song.</li>
</ul>
<p>When we run out of possibilities to try, we return <code>None</code>, signalling failure.</p></div></div>
</p><p><span id="queue_checkyourself_6"></span></p></div>
<p>
<!--START question bfs_dfs --><section aria-label="Question">
<div class="question question-multiplechoice" id="cs_qdiv_bfs_dfs" style="position: static">
<div id="bfs_dfs_rendered_question">
<div id="catsoop_preamble_bfs_dfs"></div>
<div id="catsoop_prompt_bfs_dfs" style="display: inline;">Is the code above doing a depth-first search, a breadth-first search, or something else?<br/></div>
<select aria-labelledby="catsoop_prompt_bfs_dfs" id="bfs_dfs" name="bfs_dfs">
<option value="-1">--</option>
<option selected="" value="0">DFS</option>
<option value="1">BFS</option>
<option value="2">Something else</option></select>
</div><div>
<span id="bfs_dfs_buttons">
<button class="submit btn btn-catsoop" id="bfs_dfs_submit" onclick="catsoop.submit('bfs_dfs');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="bfs_dfs_clearanswer" onclick="catsoop.clearanswer('bfs_dfs');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="bfs_dfs_loading_wrapper" role="status">
<span id="bfs_dfs_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="bfs_dfs_score_display" role="status"></span>
<div class="nsubmits_left" id="bfs_dfs_nsubmits_left" role="status">You have submitted this assignment 3 times.</div></div>
<div class="solution" id="bfs_dfs_solution_container">
<div id="bfs_dfs_solution">
<b>Solution:</b> DFS
</div>
<div id="bfs_dfs_solution_explanation"><hr/><p><b>Explanation:</b></p>
<p>Because the agenda pushes and pops items onto/from the same end of its list (i.e., a LIFO queue), it is doing DFS.</p>
</div>
</div>
<div aria-atomic="true" id="bfs_dfs_message" role="status"><img alt="Correct" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></div>
</div>
</section>
<!--END question bfs_dfs -->
</p>
<p><a class="anchor" name="catsoop_section_5_1"></a><a class="anchor" name="_a_note_on_efficiency"></a><h3 class="cs_section_title">5.1) A note on efficiency<a class="cs_permalink" href="#_a_note_on_efficiency">§</a></h3></p>
<p>Looking at the agenda while the program is solving a simple problem, we see the
following successive states, showing the search tree that it is exploring:</p>
<pre><code class="nohighlight">[set()]
[{'A'}, {'B'}, {'C'}, {'D'}]
[{'A'}, {'B'}, {'C'}, {'A', 'D'}, {'B', 'D'}, {'C', 'D'}]
[{'A'}, {'B'}, {'C'}, {'A', 'D'}, {'B', 'D'}, {'A', 'C', 'D'}, {'B', 'C', 'D'}]
[{'A'}, {'B'}, {'C'}, {'A', 'D'}, {'B', 'D'}, {'A', 'C', 'D'}]
...
</code></pre>
<p>For the impossible task with <code>target_duration</code> = 1000, we iterate through 65
versions of the agenda before failing. It explores all combinations of the four
songs, some of them multiple times, before failing. Keeping a set of
already-tested mixtapes that failed (a visited set!) would allow us to reduce this redundancy.</p>
<p><a class="anchor" name="catsoop_section_6"></a><a class="anchor" name="_sudoku"></a><h2 class="cs_section_title">6) Sudoku<a class="cs_permalink" href="#_sudoku">§</a></h2></p>
<p>To study another example that involves search and backtracking, we will build a
solver for the popular <a href="https://en.wikipedia.org/wiki/Sudoku">Sudoku</a> game. Sudoku is the name given to a variant of a
digit-placement game seen already in French newspapers in the 19th century but
popularized by a Japanese puzzle company in the 1980s. The goal is to fill
every cell of a 9x9 board with a digit 1-9 under the following constraints:</p>
<ul>
<li>No row may contain any digit more than once.</li>
<li>No column may contain any digit more than once.</li>
<li>None of the 3-3 blocks that make up the 9x9 grid may contain any digit more than once.</li>
</ul>
<p>Each of these regions holds a permutation of the digits 1 through 9,
but of course they mutually constrain each other. In addition, some of
the 81 cells are filled in with particular digits that must remain
part of the solution. The filled-in squares do not themselves violate
any of the above constraints, but their choices (how many are filled
in, in which parts of the grid, and with what digits) determine the
difficulty of any particular instance of the puzzle.  It has been
estimated that there are <span class="cs_math_to_render">6 \times 10^{21}</span> possible valid Sudoku
grids.  Here is just one example:</p>
<center>
<img src="https://py.mit.edu/_static/spring24/readings/backtracking/sudoku.svg"/>
</center>
<p>In this section, we'll walk through a process for designing a program to solve
Sudoku puzzles.  A fundamental question when starting to think about this
problem is: "How do we represent the grid?"</p>
<p>We will begin with a familiar scheme, representing the board as a list of lists
(i.e., a typical Python two-dimensional array), each grid cell holding an
assigned digit.  We'll use the digit <code>0</code> to indicate that a cell has not yet
been filled.  The solution to a Sudoku puzzle is just such a grid but one in
which no <code>0</code> entries remain and all the constraints are satisfied.</p>
<p>Such puzzles are typically hard enough that they cannot be solved by inspection
and require trial-and-error technique using backtracking to solve them.</p>
<p>Here is the overall strategy we can use:</p>
<ol>
<li>Find a <code>0</code> in the board.</li>
<li>Try to fill it with one of the digits <code>1</code>-<code>9</code>.</li>
<li>Recursively try to solve that new board; if successful, we have our answer.</li>
<li>If not, iterate over the other digits.</li>
<li>If none of the digits work, then this path fails; return <code>None</code>.</li>
</ol>
<p>Here is some code that attempts to implement this strategy:</p>
<pre><code class="language-py">def solve_sudoku(board):
    """
    Given a sudoku board (as a list-of-lists of numbers, where 0 represents an
    empty square), return a solved version of the puzzle.
    """
    for row in range(9):
        for col in range(9):
            if board[row][col] != 0:
                continue
            # Found a 0; try filling it
            for trial in range(1,10):
                new_board = [[trial if (r, c) == (row, col) else board[r][c]
                              for c in range(9)]
			     for r in range(9)]
                if valid_board(new_board):
                    result = solve_sudoku(new_board)
                    if result is not None:
                        return result
            return None
    return board
</code></pre>
<p>Note that the outer iteration over <code>row</code> and <code>col</code> is used just to find the
first open spot on the grid, not every open spot. Remaining ones will be filled
by recursive calls to <code>solve_sudoku</code>. If there aren't any open spots, then we have
succeeded and return the board.</p>
<p>Having found an open spot, we copy the existing board but with one of the 1-9
digits replacing the open spot. We then check if that new board satisfies the
constraints of Sudoku. If it does, then we recursively try to solve that new
board. If that works, we succeed and return the solved board. If it fails, we
move on to a different trial digit. If we've run through all the digits, then
there is no solution to the current board, so we fail by returning None.</p>
<p>We do need to implement a utility <code>valid_board</code> to check if the new board
violates any of the constraints. This is straightforward, using another
utility, <code>violation</code>, that sees if a list of numbers contains any duplicates
(other than <code>0</code>).</p>
<p>Here are some examples to test the program:</p>
<pre><code class="language-py">def format_sudoku(board):
    """
    Format a sudoku board to be printed to the screen
    """
    if not board:
        return 'Failed'
    _divider = '+'+''.join('-+' if i%3==2 else '-' for i in range(9))
    lines = []
    for i in range(9):
        if i % 3 == 0:
            lines.append(_divider)
        line = '|'
        for j in range(9):
            line += ' ' if board[i][j] == 0 else str(board[i][j])
            if j % 3 == 2:
                line += '|'
        lines.append(line)
    lines.append(_divider)
    return '\n'.join(lines)


grid1 = [[5,1,7,6,0,0,0,3,4],
         [2,8,9,0,0,4,0,0,0],
         [3,4,6,2,0,5,0,9,0],
         [6,0,2,0,0,0,0,1,0],
         [0,3,8,0,0,6,0,4,7],
         [0,0,0,0,0,0,0,0,0],
         [0,9,0,0,0,0,0,7,8],
         [7,0,3,4,0,0,5,6,0],
         [0,0,0,0,0,0,0,0,0]]

grid2 = [[5,1,7,6,0,0,0,3,4],
         [0,8,9,0,0,4,0,0,0],
         [3,0,6,2,0,5,0,9,0],
         [6,0,0,0,0,0,0,1,0],
         [0,3,0,0,0,6,0,4,7],
         [0,0,0,0,0,0,0,0,0],
         [0,9,0,0,0,0,0,7,8],
         [7,0,3,4,0,0,5,6,0],
         [0,0,0,0,0,0,0,0,0]]

grid3 = [[0,0,1,0,0,9,0,0,3],  # http://www.extremesudoku.info/sudoku.html
         [0,8,0,0,2,0,0,9,0],
         [9,0,0,1,0,0,8,0,0],
         [1,0,0,5,0,0,4,0,0],
         [0,7,0,0,3,0,0,5,0],
         [0,0,6,0,0,4,0,0,7],
         [0,0,8,0,0,5,0,0,6],
         [0,3,0,0,7,0,0,4,0],
         [2,0,0,3,0,0,9,0,0]]

import time
for grid in [grid1, grid2, grid3]:
    print(format_sudoku(grid))
    t = time.time()
    res = solve_sudoku(grid)
    elapsed = time.time() - t
    if res:
        print(format_sudoku(res))
    else:
        print('Failed')
    print(elapsed, 'seconds')
    print()
</code></pre>
<p>When run, these produce the following output:</p>
<pre><code class="nohighlight">+---+---+---+
|517|6  | 34|
|289|  4|   |
|346|2 5| 9 |
+---+---+---+
|6 2|   | 1 |
| 38|  6| 47|
|   |   |   |
+---+---+---+
| 9 |   | 78|
|7 3|4  |56 |
|   |   |   |
+---+---+---+
+---+---+---+
|517|698|234|
|289|134|756|
|346|275|891|
+---+---+---+
|672|849|315|
|138|526|947|
|954|713|682|
+---+---+---+
|495|362|178|
|723|481|569|
|861|957|423|
+---+---+---+
0.12484216690063477 seconds

+---+---+---+
|517|6  | 34|
| 89|  4|   |
|3 6|2 5| 9 |
+---+---+---+
|6  |   | 1 |
| 3 |  6| 47|
|   |   |   |
+---+---+---+
| 9 |   | 78|
|7 3|4  |56 |
|   |   |   |
+---+---+---+
+---+---+---+
|517|698|234|
|289|134|756|
|346|275|891|
+---+---+---+
|672|849|315|
|138|526|947|
|954|713|682|
+---+---+---+
|495|362|178|
|723|481|569|
|861|957|423|
+---+---+---+
1.297372817993164 seconds

+---+---+---+
|  1|  9|  3|
| 8 | 2 | 9 |
|9  |1  |8  |
+---+---+---+
|1  |5  |4  |
| 7 | 3 | 5 |
|  6|  4|  7|
+---+---+---+
|  8|  5|  6|
| 3 | 7 | 4 |
|2  |3  |9  |
+---+---+---+
+---+---+---+
|641|789|523|
|385|426|791|
|927|153|864|
+---+---+---+
|193|567|482|
|472|831|659|
|856|294|317|
+---+---+---+
|718|945|236|
|539|672|148|
|264|318|975|
+---+---+---+
1.5451231002807617 seconds
</code></pre>
<p>The exact timings will vary from one computer to the next, of course.</p>
<p><a class="anchor" name="catsoop_section_6_1"></a><a class="anchor" name="_improving_efficiency"></a><h3 class="cs_section_title">6.1) Improving Efficiency<a class="cs_permalink" href="#_improving_efficiency">§</a></h3></p>
<p>Now, with a satisfied smile, we may look over the program and
rejoice.  However, no program is really ever done, because it is
(almost) always possible to find improvements.  For example, although
our program works, it seems inelegant that when we find an empty spot,
we blindly create boards for all possible digits at that spot and test
each to see if they are valid. People solving Sudoku puzzles can look
at an empty spot and immediately see that the possible choices are
constrained by other digits already on the grid.  For the first example
above, we found a first empty spot at coordinates <code>(0, 4)</code> (next to the
<code>6</code> in the first row). By looking at the values already filled in in
that first row, fifth column, and the <span class="cs_math_to_render">3\times 3</span> subgrid, we can tell that the
digit to fill in cannot be any of <code>5</code>, <code>1</code>, <code>7</code>, <code>6</code>, <code>3</code>, <code>4</code>, or <code>2</code>. Thus, we
should try only the remaining digits, <code>8</code> or <code>9</code>, and avoid trying
obviously bad choices that will then be rejected by <code>valid_board</code>.</p>
<p>So let's look at writing a version of this function that implements this
strategy.  A big part of doing so will involve first determining what numbers
<em>cannot</em> go in a certain cell.  To this end, we'll define some utility
functions:</p>
<ul>
<li><code>values_in_row(board, r)</code> returns the nonzero integers present in row <code>r</code> in the given board (<code>r=0</code> represents the top-most row).  For example, in the example board above, <code>values_in_row(board, 1)</code> should return some collection containing <code>6</code>, <code>1</code>, <code>9</code>, and <code>5</code>.</li>
<li><code>values_in_column(board, c)</code> returns the nonzero integers present in column <code>c</code> in the given board (<code>c=0</code> represents the left-most column).  For example, in the example board above, <code>values_in_column(board, 3)</code> should return a collection containing <code>1</code>, <code>8</code>, and <code>4</code>.</li>
<li><code>values_in_subgrid(board, sr, sc)</code> returns the nonzero integers in the subgrid identified by <code>sr</code> and <code>sc</code>. These are the coordinates of the subgrid in the 3x3 arrangement of subgrids in the overall grid. <code>sr</code> and <code>sc</code> are both in the range 0-2, i.e., <code>range(0, 3)</code>.  <code>(sr=0, sc=0)</code> represents the top-left-most subgrid, and <code>(sr=2, sc=2)</code> represents the bottom-right-most subgrid.  For example, in the example board above, <code>values_in_subgrid(board, 1, 2)</code> should return a collection containing <code>3</code>, <code>1</code>, and <code>6</code>.</li>
</ul>
<p>
<!--START question sudoku_helpers --><section aria-label="Question">
<div class="question question-pythoncode" id="cs_qdiv_sudoku_helpers" style="position: static">
<div id="sudoku_helpers_rendered_question">
<div id="catsoop_preamble_sudoku_helpers"></div>
<div id="catsoop_prompt_sudoku_helpers" style="display: inline;">In the box below, fill in the definitions for these functions.  The return type is up to you, but it must be a collection and it must contain the correct numbers.<br/></div>
<textarea id="sudoku_helpers" name="sudoku_helpers">def values_in_row(board, r):
    container = []
    for c in range(9):
        if board[r][c] != 0:
            container.append(board[r][c])
    return container

def values_in_column(board, c):
    container = []
    for r in range(9):
        if board[r][c] != 0:
            container.append(board[r][c])
    return container

def values_in_subgrid(board, sr, sc):
    container = []
    for i in range(3*sr, (sr +1)*3):
        for j in range(3*sc, (sc+1)*3):
            if board[i][j] !=0:
                container.append(board[i][j])
    return container
        
        
</textarea>
<script type="text/javascript">
var cs_codemirror_sudoku_helpers = catsoop.codemirror.editorFromTextArea(document.getElementById('sudoku_helpers'), 'python');
</script>
</div><div>
<span id="sudoku_helpers_buttons">
<button class="submit btn btn-catsoop" id="sudoku_helpers_submit" onclick="catsoop.submit('sudoku_helpers');" style="margin-top: 10px;">Submit</button>
<button class="clearanswer btn btn-catsoop" id="sudoku_helpers_clearanswer" onclick="catsoop.clearanswer('sudoku_helpers');" style="margin-top: 10px;">Clear Answer</button></span>
<span id="sudoku_helpers_loading_wrapper" role="status">
<span id="sudoku_helpers_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="sudoku_helpers_score_display" role="status"></span>
<div class="nsubmits_left" id="sudoku_helpers_nsubmits_left" role="status">You have submitted this assignment 2 times.</div></div>
<div class="solution" id="sudoku_helpers_solution_container">
<div id="sudoku_helpers_solution">
Here is the solution we wrote:<br/>
<pre><code class="lang-python" id="sudoku_helpers_soln_highlight">
def values_in_row(board, r):
    """
    Return a set containing all of the values in a given row.
    """
    return set(board[r]) - {0}


def values_in_column(board, c):
    """
    Return a set containing all of the values in a given column.
    """
    return {board[r][c] for r in range(len(board))} - {0}


def values_in_subgrid(board, sr, sc):
    """
    Return a set containing all of the values in a given subgrid.
    """
    return {board[r][c]
            for r in range(sr*3, (sr+1)*3)
            for c in range(sc*3, (sc+1)*3)} - {0}
</code></pre>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
hljs.highlightBlock(document.getElementById("sudoku_helpers_soln_highlight"));
// @license-end
</script>
</div>
<div id="sudoku_helpers_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="sudoku_helpers_message" role="status">
<br/> Your score on your most recent submission was: 100.00%<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/>
<br/><details><summary class="btn btn-catsoop">Show/Hide Detailed Results</summary><div class="response" id="sudoku_helpers_result_showhide"><h2>Test Results:</h2>
<center><h3>Test 01</h3>
<i></i></center><p></p>
The test case was:<br/>
<p><tt>#Your Code Here<br/><br/>grid  = [[5,1,7,6,0,0,0,3,4],<br/>         [0,8,9,0,0,4,0,0,0],<br/>         [3,0,6,2,0,5,0,9,0],<br/>         [6,0,0,0,0,0,0,1,0],<br/>         [0,3,0,0,0,6,0,4,7],<br/>         [0,0,0,0,0,0,0,0,0],<br/>         [0,9,0,0,0,0,0,7,8],<br/>         [7,0,3,4,0,0,5,6,0],<br/>         [0,0,0,0,0,0,0,0,0]]<br/>         <br/>ans = set(values_in_row(grid, 6))</tt></p><p> </p>
<p>Our solution produced the following value for <tt>ans</tt>:
<br/><font color="blue"><tt style="white-space: pre-wrap">{8, 9, 7}</tt></font></p><p> </p>
<p>Your submission produced the following value for <tt>ans</tt>:
<br/><font color="blue"><tt style="white-space: pre-wrap">{8, 9, 7}</tt></font><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></p>
<p></p><hr/><p></p>
<center><h3>Test 02</h3>
<i></i></center><p></p>
The test case was:<br/>
<p><tt>#Your Code Here<br/><br/>grid  = [[5,1,7,6,0,0,0,3,4],<br/>         [0,8,9,0,0,4,0,0,0],<br/>         [3,0,6,2,0,5,0,9,0],<br/>         [6,0,0,0,0,0,0,1,0],<br/>         [0,3,0,0,0,6,0,4,7],<br/>         [0,0,0,0,0,0,0,0,0],<br/>         [0,9,0,0,0,0,0,7,8],<br/>         [7,0,3,4,0,0,5,6,0],<br/>         [0,0,0,0,0,0,0,0,0]]<br/>         <br/>ans = set(values_in_column(grid, 1))</tt></p><p> </p>
<p>Our solution produced the following value for <tt>ans</tt>:
<br/><font color="blue"><tt style="white-space: pre-wrap">{8, 1, 3, 9}</tt></font></p><p> </p>
<p>Your submission produced the following value for <tt>ans</tt>:
<br/><font color="blue"><tt style="white-space: pre-wrap">{8, 1, 3, 9}</tt></font><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></p>
<p></p><hr/><p></p>
<center><h3>Test 03</h3>
<i></i></center><p></p>
The test case was:<br/>
<p><tt>#Your Code Here<br/><br/>grid  = [[5,1,7,6,0,0,0,3,4],<br/>         [0,8,9,0,0,4,0,0,0],<br/>         [3,0,6,2,0,5,0,9,0],<br/>         [6,0,0,0,0,0,0,1,0],<br/>         [0,3,0,0,0,6,0,4,7],<br/>         [0,0,0,0,0,0,0,0,0],<br/>         [0,9,0,0,0,0,0,7,8],<br/>         [7,0,3,4,0,0,5,6,0],<br/>         [0,0,0,0,0,0,0,0,0]]<br/>         <br/>ans = set(values_in_subgrid(grid, 1, 2))</tt></p><p> </p>
<p>Our solution produced the following value for <tt>ans</tt>:
<br/><font color="blue"><tt style="white-space: pre-wrap">{1, 4, 7}</tt></font></p><p> </p>
<p>Your submission produced the following value for <tt>ans</tt>:
<br/><font color="blue"><tt style="white-space: pre-wrap">{1, 4, 7}</tt></font><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABQVBMVEUAAAAGDQAAAAAAAAAAAAAAAAAAAACGqlBIfBNciiZGeg9Eeg5Feg5Gew9CdgpCdgxDehJvmDN1nj9plTVWhRtOgRlMfxZjkS5Geg9EeA5Geg5HfBBHew5GeQ5Cdg1CeAxDegtHgACVtmV+pURPgBp4oEBEeQx+o0p8oklFeg5YiCJIfRFEdQ5GehBHeg9CdwtEdQxEeg5Fdw5DeQ1Eegs2YQlCdwpCeAxDeQ0PHgBGdA9AdgkAAAAAAAARIgChwGKPs0qjwXKStUyFqD6CqDfJ3p+91Ji00XqlwmypyGihwGiauluWtlicwFKXulGTuEmMr0WOs0OKr0CGrDuEqjrR46zC2Ji+1ZC804640oK1z4CxzHywynqsx3enw3WYuWidvF+fwlqgxFePsFWSs1KIrE2Wu0uOr0qGqkeCpj50nDHRgoCJAAAAP3RSTlMABA0HEgoQ/ff17+jbxi8nDvz39vb29fTy7dPQoJeLVRUJ/f39+vn49/f118jAvrKWcW9jWllJQjkiIRwZFg8RajNxAAAA+klEQVQY06XQ1bLCMBAGYNJCHXfnuLtrFXc5gru+/wMQhhZouWRvMvNt/kx2dbvUC+V/3tY9OhZzX5i0HDqNxn/aRo2aXb/JXtR+p2HjfjUb5xmg1kfyL9v9d76q1UK1kqPaSWAFy1TQVs+zvCci4wd9fA8PE9HM5Rvkg5JlcJ68iuh8OFtkcb/ywrUtlUscUTfniaKQIlaj0AdsoZTuH2aEUsceXM/AuNNcmcsIZW7otWwsIuCacBVJqgycYdWPwx7rWJQKVu0y3n0OUZyemVUIAPp9S8wcIQRBDCgAsqIGBNM/eS/fPr/02KKx5IXDBixsfV2OwCYERebVjyGAvqhE3QAAAABJRU5ErkJggg=="/></p>
</div></details></div>
</div>
</section>
<!--END question sudoku_helpers -->
</p>
<p>With these helpers in hand, we can figure out which values are allowed for
a given grid and only try those values.  This avoids the need to write the
function that checks for a board's validity, which simplifies the code
dramatically.</p>
<p>Instead, we define <code>valid_moves</code> to compute what digits are valid at that spot
based on the same constraints that <code>valid_board</code> had used, but in a much simpler
way:</p>
<pre><code class="language-py">def solve_sudoku(board):
    """
    Given a sudoku board (as a list-of-lists of numbers, where 0 represents an
    empty square), return a solved version of the puzzle.
    """
    for row in range(9):
        for col in range(9):
            if board[row][col] != 0:
                continue
            # Found a 0; try filling it
            for trial in valid_moves(board, row, col):
                new_board = [[trial if (r, c) == (row, col) else board[r][c] for c in range(9)]
                              for r in range(9)]
                # no need to check for victory; new_board is valid by construction!
                result = solve_sudoku(new_board)
                if result is not None:
                    return result
            return None
    return board
</code></pre>
<div class="question"><b>Check Yourself:</b><p><p>This code relies on a function called <code>valid_moves</code> to tell us what numbers can
go in a given spot.  Using your functions from above, how should that function look?</p>
<div class="response"><button aria-pressed="false" class="btn btn-catsoop showhide-toggle" onclick='this.setAttribute("aria-pressed", this.getAttribute("aria-pressed") === "true" ? "false" : "true");' role="button">Show/Hide</button><div>Here is one possible solution, assuming that the helpers above are returning sets:
<pre><code class="language-py">def valid_moves(board, row, col):
    return (
        set(range(1, 10))  # all possible moves
        - values_in_row(board, row)  # exclude values already in the row
        - values_in_column(board, col)  # exclude values already in the column
        - values_in_subgrid(board, row//3, col//3)  # exclude values already in the subgrid
    )
</code></pre>
<p>Of course, it's possible to make this work even if you chose a different type to
return from your helper functions; but the choice of sets here really puts us in
a good position to write <code>valid_moves</code> in a very concise way by using the built in
<code>-</code> operation on sets (which implements a <a href="https://docs.python.org/3/library/stdtypes.html#frozenset.difference">"set difference"</a>).</p></div></div>
</p><p><span id="queue_checkyourself_7"></span></p></div>
<p>Although the resulting solutions differ a bit from what we had earlier, this is
understandable.  Iterating over a set likely puts digits in a different order
than when we iterated over a range. Because these puzzles often have multiple
valid solutions, that ordering can affect which solution we find.
Nevertheless, in all three examples, the running time of this improved version
is more than an order of magnitude less than of the original.  And, not only is this
solution more efficient than what we saw earlier, arguably an even bigger benefit is
that it is simpler and more concise as well!</p>
<p><a class="anchor" name="catsoop_section_6_2"></a><a class="anchor" name="_improving_efficiency_mutation"></a><h3 class="cs_section_title">6.2) Improving Efficiency: Mutation<a class="cs_permalink" href="#_improving_efficiency_mutation">§</a></h3></p>
<p>Following up the "no program is really ever done" theme, you might be troubled
by all the boards we are still copying (though fewer than before). Could we
instead reuse the same board over and over, mutating its values as needed? The
answer is "yes", though one should undertake such an approach with great
caution. Mutating data structures is fraught with opportunities for
aliasing-related bugs, and such errors are often extremely difficult to debug.
Nevertheless, we proceed!</p>
<p>Instead of constructing <code>new_board</code>, we will just modify <code>board</code>, but then we have
to remember to "unmodify" it if filling in none of the trial values lead to
success.</p>
<pre><code class="language-py highlight-lines">def solve_sudoku(board):
    """
    Given a sudoku board (as a list-of-lists of numbers, where 0 represents an
    empty square), return a solved version of the puzzle.
    """
    for row in range(9):
        for col in range(9):
            if board[row][col] != 0:
                continue
            # Found a 0; try filling it
            for trial in valid_moves(board, row, col):
                board[row][col] = trial
                result = solve_sudoku(board)
                if result is not None:
                    return result
            board[row][col] = 0
            return None
    return board
</code></pre>
<p>This looks similar to our code from above, but line 12 mutates <code>board</code> instead
of making a new board, and we have a new addition.  Line 16 is not equivalent
to anything from our earlier code; why is it even there?</p>
<p>This is a subtle point, but that line is <em>critical</em>.  The high-level idea is
that, each step along the way, we replace a <code>0</code> from the original board with
some new number <span class="cs_math_to_render">n</span>.  Then, recursive calls that we make (and <em>their</em> recursive
calls and so on, all of which share the same <code>board</code>) assume that <span class="cs_math_to_render">n</span> is
necessarily in that spot!  If we eventually decide that there is no solution
from that recursive call, we need to make sure to <em>undo</em> our action of putting
<span class="cs_math_to_render">n</span> in that spot (so that other recursive calls no longer assume that <span class="cs_math_to_render">n</span> must
be in that spot).  Without setting that value back to <code>0</code>, we would get
incorrect results (often, our code would indicate that there is no solution,
even for boards that <em>can</em> be solved).</p>
<p>Again, there's a lot of danger here.  So why bother?  Well, in many cases, we
might actually recommend <em>not</em> bothering, since the version that only uses
immutable data types is generally much safer.  But one reason that we might
risk those dangers is that we get another substantial speed improvement by
avoiding the repeated copying of our game board: in this case, around 3x!</p>
<p>Here is a table summarizing timing on our three examples with our original
solution, the <code>valid_moves</code> change, and the mutating method:</p>
<center>
<table border="1">
<tr><th></th><th>Original Code</th><th>Only Valid Moves</th><th>Mutate Instead of Copy</th></tr>
<tr><td align="center"><code>grid1</code></td><td align="center">0.125</td><td align="center">0.014</td><td align="center">0.004</td></tr>
<tr><td align="center"><code>grid2</code></td><td align="center">1.297</td><td align="center">0.123</td><td align="center">0.044</td></tr>
<tr><td align="center"><code>grid3</code></td><td align="center">1.545</td><td align="center">0.149</td><td align="center">0.050</td></tr>
</table>
</center>
<p><a class="anchor" name="catsoop_section_7"></a><a class="anchor" name="_summary"></a><h2 class="cs_section_title">7) Summary<a class="cs_permalink" href="#_summary">§</a></h2></p>
<p>In this reading, our focus has been on a particular kind of recursive structure
that we refer to as <em>backtracking</em>.  This kind of structure typically contains a few
pieces:</p>
<ul>
<li>A base case signifying a trivial "success."</li>
<li>A base case signifying a "failure."</li>
<li>Recursive case(s) that distinguish between those cases to try different possibilities
for one small part of a subproblem (e.g., adding a single song to the mixtape or placing
a single number in Sudoku).  If that change leads to a failure in a recursive call, we
try the next possibility; and only when all possibilities have failed do we signal failure.</li>
</ul>
<p>We saw this approach applied to two different problems in this reading, and we
saw that it is actually implementing a depth-first search, with Python's normal
mechanism for keeping track of stack frames serving the role that the "agenda"
served in our iterative graph-search programs.</p>
<p><script type="text/javascript">
catsoop.callbacks['submit'] = function(ok, names, status, response){
    response = JSON.parse(response);
    if (response[names[0]].score == 1){
        document.getElementById(names[0] + '_viewanswer').click();
    }
}
</script></p>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
catsoop.all_questions = ['first_error_decoding', 'failure_base_case_return', 'truthiness_bug', 'so_far_return', 'bfs_dfs', 'sudoku_helpers'];
catsoop.username = 'gvargas1';
catsoop.this_path = 'https://py.mit.edu/spring24/readings/backtracking';
catsoop.path_info = ['spring24', 'readings', 'backtracking'];
catsoop.course = 'spring24';
catsoop.url_root = 'https://py.mit.edu';
catsoop.imp = '';
catsoop.skip_alert = ["first_error_decoding", "failure_base_case_return", "truthiness_bug", "so_far_return", "bfs_dfs", "sudoku_helpers"];
catsoop.viewans_confirm = "Are you sure?  Viewing the answer will prevent any further submissions to this question.  Press 'OK' to view the answer, or press 'Cancel' if you have changed your mind.";

// @license-end</script>
<div id="cs_footnotes" style="display:none;"></div>
</div>
</div>
<div class="cs_right_menu"></div>
</div>
<footer>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_bottom_navigation" id="cs_bottom_navigation"><li><a href="https://py.mit.edu/spring24">Home</a></li><li><a href="https://py.mit.edu/spring24/readings">Course Readings</a></li><li><a href="https://py.mit.edu/spring24/readings/backtracking">Backtracking</a></li></nav>
<div class="cs_footer">
      This page was last updated on Sunday March 31, 2024 at 01:44:55 PM (revision <code>5a1e9196</code>).<br/> <br/>
<center><img src="https://py.mit.edu/_static/spring24/readings/cc-by-sa.svg" style="width: 2cm;"/></center><div style="max-width: 600px; margin-bottom:1em; margin-left:auto; margin-right:auto;">Except where otherwise noted, these readings are licensed under a<br/><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">Creative Commons BY-SA 4.0</a> license.  Portions of the readings were derived from<br/>or inspired by the <a href="https://web.mit.edu/6.031/www/sp24/" target="_blank">6.031 Course Notes</a>, the <a href="https://hz.mit.edu/catsoop/6.145" target="_blank">6.145 Course Notes</a>, and the 6.01 Course Notes.
</div>
<pre class="catsooplogo" style="font-size:50%;">\            
/    /\__/\  
\__=(  o_O )=
(__________) 
 |_ |_ |_ |_ </pre>
      Powered by <a href="https://catsoop.org" target="_blank">CAT-SOOP</a> v19.0.6+hg.3.118aecfb "Korat" (LTS) (development snapshot).<br/>
      CAT-SOOP is <a href="https://www.fsf.org/about/what-is-free-software" target="_blank">Free/Libre Software</a>, available under the terms<br/>of the <a href="https://py.mit.edu/_util/license" target="_blank">GNU Affero General Public License, version 3</a>.<br/>
<a download="" href="https://py.mit.edu/_util/source.zip" target="_blank">Download Source Code</a><br/>
<a href="https://py.mit.edu/_util/jslicense.html" rel="jslicense" target="_blank">Javascript License Information</a>
</div>
</footer>
</body>
</html>

